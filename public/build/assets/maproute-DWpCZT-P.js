import{u as q,r as c,j as e,a as O,H as ee}from"./app-D9XB0GKv.js";import{u as te,G as se,d as ae,l as le,M as ne,P as re,I as oe}from"./esm-D_7yRZiN.js";import{D as U,a as W,b as V,c as K,d as ie,e as ce,f as de}from"./dialog-C-9lORf2.js";import{I as L}from"./input-c20-QkMX.js";import{B as v,c as F}from"./app-logo-icon-DNX6Rdqm.js";import{C as $,a as G,b as H,B as X,c as B}from"./badge-CAcXzHsf.js";import{M as Q}from"./map-pin-BZdtpYzu.js";import{E as me,T as ue}from"./trash-2-hI2B0v1r.js";import{L as P}from"./label-BKt9iFns.js";import{a as pe,S as he,y as T}from"./app-layout-Bo_T2kxO.js";import{R as ge}from"./route-CkTB_mSf.js";/* empty css            */import"./createLucideIcon-C6xnCVKw.js";import"./index-Q0z0t_J0.js";import"./index-BN61bmm7.js";import"./users-C8PTD9Dh.js";const xe={width:"100%",height:"450px"},fe={lat:10.6676,lng:122.9456},je=["places","drawing"];function ye({stops:r,setStops:n,clearTrigger:f,polylines:d,setPolylines:g,savedPolylines:i,routeColor:u}){const{isLoaded:y}=te({googleMapsApiKey:"AIzaSyAicbS4J0S5M2DRMdOsImk3FGYFb8tJCPY",libraries:je}),{appearance:N}=q(),[C,D]=c.useState(!1),[S,R]=c.useState(null),[k,j]=c.useState(!1),[o,b]=c.useState(null),M=c.useRef([]);c.useEffect(()=>{const l=window.matchMedia("(prefers-color-scheme: dark)").matches;D(N==="dark"||N==="system"&&l)},[N]),c.useEffect(()=>{!i||i.length===0||g(l=>l.length===i.length&&l.every((a,h)=>{const m=i[h];return a.id===m.id&&a.path.length===m.path.length&&a.path.every((s,p)=>s.lat===m.path[p].lat&&s.lng===m.path[p].lng)})?l:i)},[i]),c.useEffect(()=>{f&&(g([]),n([]))},[f,n]),c.useEffect(()=>{if(!S||!i||i.length===0)return;M.current.forEach(t=>t.setMap(null)),M.current=[];const l=new google.maps.LatLngBounds;i.forEach(t=>{const a=t.path.map(m=>{const s=typeof m.lat=="string"?parseFloat(m.lat):m.lat,p=typeof m.lng=="string"?parseFloat(m.lng):m.lng;return l.extend({lat:s,lng:p}),{lat:s,lng:p}}),h=new google.maps.Polyline({path:a,strokeColor:t.color,strokeWeight:3,editable:!1,map:S});M.current.push(h)}),l.isEmpty()||S.fitBounds(l)},[S,i]);const z=l=>{if(!l.latLng)return;const t={lat:l.latLng.lat(),lng:l.latLng.lng()};b({position:t,name:""}),j(!0)},A=()=>{o&&o.name.trim()&&(n([...r,{name:o.name,position:o.position}]),j(!1),b(null))},E=l=>{R(l);const t=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.POLYLINE,drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT,drawingModes:[google.maps.drawing.OverlayType.POLYLINE,google.maps.drawing.OverlayType.MARKER]},polylineOptions:{strokeColor:"#3b82f6",strokeWeight:3,editable:!0,geodesic:!0}});t.setMap(l),google.maps.event.addListener(t,"overlaycomplete",async a=>{if(a.type===google.maps.drawing.OverlayType.POLYLINE){const h=a.overlay,m=h.getPath().getArray().map(p=>({lat:p.lat(),lng:p.lng()})),s={id:Date.now(),path:m,color:u};g(p=>[...p,s]),h.setMap(null)}})};return e.jsxs("div",{className:"flex justify-center py-6",children:[e.jsxs("div",{className:"w-full max-w-6xl rounded-2xl shadow-xl overflow-hidden border border-gray-200 dark:border-gray-700",children:[!y&&e.jsxs("div",{className:"relative h-[450px] flex items-center justify-center bg-gray-100 dark:bg-gray-800 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-blue-500"}),e.jsx("span",{className:"absolute mt-16 text-gray-700 dark:text-gray-200",children:"Loading map..."})]}),y&&e.jsxs(se,{mapContainerStyle:xe,center:fe,zoom:12,onClick:z,onLoad:E,options:{styles:C?ae:le,disableDefaultUI:!0,zoomControl:!0,gestureHandling:"greedy"},children:[r.map((l,t)=>e.jsx(ne,{position:l.position,title:l.name,label:{text:`${t+1}`,color:C?"#000000":"#FFFFFF",fontSize:"12px",fontWeight:"bold"},icon:{path:google.maps.SymbolPath.CIRCLE,scale:12,fillColor:C?"#FFD700":"#2196F3",fillOpacity:1,strokeWeight:2,strokeColor:C?"#fff":"#000"}},t)),d.map((l,t)=>e.jsx(re,{path:l.path,options:{strokeColor:l.color,strokeOpacity:1,strokeWeight:3,editable:!0,geodesic:!0}},t))]})]}),e.jsx(U,{open:k,onOpenChange:l=>{j(l),l||b(null)},children:e.jsxs(W,{children:[e.jsx(V,{children:e.jsx(K,{children:"Add Stop"})}),e.jsx(L,{placeholder:"Enter stop name",value:o?.name||"",onChange:l=>b(t=>t?{...t,name:l.target.value}:null)}),e.jsxs(ie,{children:[e.jsx(v,{variant:"outline",onClick:()=>{j(!1),b(null)},children:"Cancel"}),e.jsx(v,{onClick:A,disabled:!o?.name.trim(),children:"Save"})]})]})})]})}function Ne({className:r,...n}){return e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{className:F("w-full caption-bottom text-sm",r),...n})})}function be({className:r,...n}){return e.jsx("thead",{className:F("[&_tr]:border-b",r),...n})}function we({className:r,...n}){return e.jsx("tbody",{className:F("[&_tr:last-child]:border-0",r),...n})}function J({className:r,...n}){return e.jsx("tr",{className:F("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",r),...n})}function _({className:r,...n}){return e.jsx("th",{className:F("h-10 px-2 text-left align-middle font-medium text-muted-foreground",r),...n})}function I({className:r,...n}){return e.jsx("td",{className:F("p-2 align-middle",r),...n})}function ve({routes:r,onView:n,onDelete:f}){return r.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Q,{className:"mx-auto h-12 w-12 text-muted-foreground"}),e.jsx("h3",{className:"mt-2 text-sm font-semibold text-foreground",children:"No Routes"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Get started by creating your first route."})]}):e.jsx("div",{className:"space-y-6",children:r.map((d,g)=>e.jsxs($,{className:"shadow-md max-w-5xl mx-auto",style:{borderLeftColor:d.color},children:[e.jsx(G,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs(H,{className:"flex items-center gap-2 text-lg",children:[e.jsx("span",{className:"truncate",children:d.firstTerminal}),e.jsx("span",{className:"text-muted-foreground",children:"→"}),e.jsx("span",{className:"truncate",children:d.secondTerminal})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs(X,{variant:"secondary",className:"text-xs",children:[d.stops.length," stops"]}),e.jsx("div",{className:"w-4 h-4 rounded-full border border-border",style:{backgroundColor:d.color},"aria-label":`Route color: ${d.color}`})]})]}),e.jsxs("div",{className:"flex flex-shrink-0 gap-2",children:[n&&e.jsxs(v,{size:"sm",variant:"outline",onClick:()=>n(d),className:"whitespace-nowrap",children:[e.jsx(me,{className:"w-4 h-4 mr-1"}),"View"]}),e.jsxs(v,{size:"sm",variant:"destructive",onClick:()=>f(d.id),className:"whitespace-nowrap",children:[e.jsx(ue,{className:"w-4 h-4 mr-1"}),"Delete"]})]})]})}),e.jsx(B,{className:"pt-0",children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(Ne,{children:[e.jsx(be,{children:e.jsxs(J,{className:"bg-muted/30",children:[e.jsx(_,{className:"font-semibold",children:"#"}),e.jsx(_,{className:"font-semibold",children:"Stop Name"}),e.jsx(_,{className:"font-semibold",children:"Coordinates"})]})}),e.jsx(we,{children:d.stops.map((i,u)=>e.jsxs(J,{className:"hover:bg-muted/20",children:[e.jsx(I,{className:"font-medium text-muted-foreground",children:u+1}),e.jsx(I,{className:"font-medium",children:i.name||"Unnamed Stop"}),e.jsx(I,{className:"font-mono text-sm",children:i.lat!=null&&i.lng!=null?`${Number(i.lat).toFixed(5)}, ${Number(i.lng).toFixed(5)}`:"No coordinates"})]},u))})]})})})]},g))})}function Ce(){const r=[{name:"Fortune Towne - Central Market",image:"/fortunetowne.jpg"},{name:"Homesite - Central Market",image:"/homesite.jpg"},{name:"Granada - Burgos",image:"/burgosgranada.jpg"}],[n,f]=c.useState(0),[d,g]=c.useState(!1),[i,u]=c.useState({x:0,y:0}),[y,N]=c.useState(null),C=()=>{f(o=>o===0?r.length-1:o-1),g(!1),u({x:0,y:0})},D=()=>{f(o=>o===r.length-1?0:o+1),g(!1),u({x:0,y:0})},S=o=>{d&&(o.preventDefault(),N({x:o.clientX-i.x,y:o.clientY-i.y}))},R=o=>{!d||!y||u({x:o.clientX-y.x,y:o.clientY-y.y})},k=()=>N(null),j=()=>N(null);return e.jsxs(U,{children:[e.jsx(ce,{asChild:!0,children:e.jsx(v,{children:"Open Map Guide"})}),e.jsxs(W,{className:"max-w-5xl",children:[e.jsxs(V,{children:[e.jsx(K,{className:"text-xl font-semibold text-center",children:"Map Route Guide"}),e.jsx(de,{className:"text-center",children:"View and navigate through jeepney routes with zoom and pan functionality."})]}),e.jsxs("div",{className:"relative mt-4 flex flex-col items-center overflow-hidden w-full max-h-[600px] rounded-lg",onMouseMove:R,onMouseUp:k,onMouseLeave:j,children:[e.jsx("img",{src:r[n].image,alt:r[n].name,className:`object-cover cursor-${d?"grab":"zoom-in"} transition-transform duration-300`,style:{width:"100%",maxHeight:"600px",transform:`scale(${d?2:1}) translate(${i.x/(d?2:1)}px, ${i.y/(d?2:1)}px)`,cursor:d?"grab":"zoom-in"},onClick:()=>g(o=>!o),onMouseDown:S}),e.jsx("p",{className:"mt-4 text-center text-lg font-medium",children:r[n].name}),e.jsxs("div",{className:"absolute top-1/2 w-full flex justify-between px-6 -translate-y-1/2",children:[e.jsx(v,{variant:"outline",size:"lg",onClick:C,children:"◀"}),e.jsx(v,{variant:"outline",size:"lg",onClick:D,children:"▶"})]})]})]})]})}const Se=[{title:"Map Route",href:"/maproute"}];function He(){const[r,n]=c.useState([]),[f,d]=c.useState(""),[g,i]=c.useState(""),[u,y]=c.useState([]),[N,C]=c.useState(!0),[D,S]=c.useState(!1),[R,k]=c.useState([]),[j,o]=c.useState(null),[b,M]=c.useState("#3388ff");c.useEffect(()=>{O.get("https://turnup-admin.com/sanctum/csrf-cookie",{withCredentials:!0}).then(()=>console.log("CSRF cookie set")).catch(t=>console.error(t))},[]),c.useEffect(()=>{(async()=>{try{const h=await(await fetch("/routes")).json(),m=await Promise.all(h.map(async(s,p)=>{let x=[];if(typeof s.polyline=="string")try{x=JSON.parse(s.polyline).map(Y=>({lat:Number(Y.lat),lng:Number(Y.lng)}))}catch{x=[]}else Array.isArray(s.polyline)?x=s.polyline.map(w=>({lat:Number(w.lat),lng:Number(w.lng)})):s.polyline&&(x=[{lat:Number(s.polyline.lat),lng:Number(s.polyline.lng)}]);const Z=await E(x.map(w=>({lat:Number(w.lat),lng:Number(w.lng)})));return{id:s.id??p,firstTerminal:s.first_terminal,secondTerminal:s.second_terminal,polyline:Z,stops:s.stops.map(w=>({name:w.name,lat:Number(w.lat),lng:Number(w.lng)})),color:s.color??"#3388ff"}}));n(m)}catch(a){console.error("Failed to fetch routes",a)}})()},[]);const z=async()=>{if(!f||!g){T.error("Please fill in both terminals");return}if(u.length<2){T.error("Please add at least 2 stops before saving the route");return}try{await O.get("https://turnup-admin.com/sanctum/csrf-cookie",{withCredentials:!0});const t={first_terminal:f,second_terminal:g,polyline:R[0]?.path??[],stops:u.map(s=>({name:s.name,lat:s.position.lat,lng:s.position.lng})),color:b},a=await O.post("https://turnup-admin.com/routes",t,{withCredentials:!0});let h=[];if(typeof a.data.polyline=="string")try{h=JSON.parse(a.data.polyline).map(p=>({lat:Number(p.lat),lng:Number(p.lng)}))}catch{h=[]}else Array.isArray(a.data.polyline)?h=a.data.polyline.map(s=>({lat:Number(s.lat),lng:Number(s.lng)})):a.data.polyline&&(h=[{lat:Number(a.data.polyline.lat),lng:Number(a.data.polyline.lng)}]);const m={id:a.data.id??Date.now(),firstTerminal:a.data.first_terminal,secondTerminal:a.data.second_terminal,polyline:h.map(s=>({lat:Number(s.lat),lng:Number(s.lng)})),stops:a.data.stops.map(s=>({name:s.name,lat:Number(s.lat),lng:Number(s.lng)})),color:"#3388ff"};n(s=>[...s,m]),d(""),i(""),y([]),T.success("Route added successfully")}catch(t){T.error("Failed to save route."),console.log(t)}},A=async t=>{try{await O.delete(`https://turnup-admin.com/routes/${t}`,{withCredentials:!0}),n(a=>a.filter(h=>h.id!==t)),j?.id===t&&(o(null),y([]),k([])),T.success("Delete Route Successfully")}catch(a){console.error("Failed to delete route",a),T.error("Failed to delete route.")}},E=async t=>{if(t.length===0)return[];const a=t.filter(x=>!isNaN(x.lat)&&!isNaN(x.lng));if(a.length===0)return[];const m=`https://roads.googleapis.com/v1/snapToRoads?path=${a.map(x=>`${x.lat},${x.lng}`).join("|")}&interpolate=true&key=AIzaSyAicbS4J0S5M2DRMdOsImk3FGYFb8tJCPY`,p=await(await fetch(m)).json();return p.snappedPoints?p.snappedPoints.map(x=>({lat:x.location.latitude,lng:x.location.longitude})):[]},l=f&&g&&u.length>=2;return e.jsxs(pe,{breadcrumbs:Se,children:[e.jsx(ee,{title:"Map Route"}),e.jsxs($,{className:"w-full max-w-4xl mx-auto m-6",children:[e.jsx(G,{children:e.jsxs(H,{className:"flex items-center justify-between",children:["Create Route",e.jsxs(X,{variant:l?"default":"secondary",children:[u.length," stops"]})]})}),e.jsxs(B,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"first_terminal",children:"First Terminal"}),e.jsx(L,{id:"first_terminal",name:"firstTerminal",placeholder:"First Terminal",value:f,onChange:t=>d(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"second_terminal",children:"Second Terminal"}),e.jsx(L,{id:"second_terminal",name:"secondTerminal",placeholder:"Second Terminal",value:g,onChange:t=>i(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"route_color",children:"Route Color"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{type:"color",id:"route_color",value:b,onChange:t=>M(t.target.value),className:"w-12 h-10 p-1 cursor-pointer"}),e.jsx(L,{type:"text",value:b,onChange:t=>M(t.target.value),placeholder:"#3b82f6",className:"flex-1"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-lg bg-muted/30",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${u.length<2?"bg-orange-400":"bg-green-400"}`}),e.jsx("p",{className:"text-sm text-muted-foreground",children:u.length<2?"Add at least 2 stops to save and draw routes.":"Ready to save the route"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:[e.jsx(v,{onClick:z,disabled:!f||!g||u.length<2,children:"Save Route"}),e.jsx(v,{variant:"destructive",onClick:()=>S(t=>!t),disabled:u.length===0,children:"Clear Route"}),e.jsx(Ce,{})]})]})]}),e.jsx("div",{className:"mt-6",children:e.jsx(ye,{stops:u,setStops:y,clearTrigger:D,polylines:R,setPolylines:k,savedPolylines:j?[{id:j.id,path:j.polyline,color:j.color??"#3388ff"}]:[],snapToRoad:E,routeColor:b})}),e.jsx("div",{className:"m-4",children:e.jsx(v,{onClick:()=>C(!N),children:N?"Hide Routes Table":"Show Routes Table"})}),N&&e.jsx(ve,{routes:r,onView:t=>{j?.id===t.id?(o(null),y([]),k([])):(y(t.stops.map(a=>({name:a.name,position:{lat:a.lat,lng:a.lng}}))),k([{id:t.id,path:t.polyline,color:t.color}]),o(t))},onDelete:A}),e.jsxs($,{className:"m-10",children:[e.jsx(G,{className:"pb-3",children:e.jsxs(H,{className:"flex items-center gap-2 text-lg",children:[e.jsx(oe,{size:18}),"Quick Start Guide"]})}),e.jsxs(B,{className:"pt-0",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Q,{size:16,className:"text-blue-500"}),e.jsx("h3",{className:"font-medium text-base",children:"Creating a Route"})]}),e.jsxs("ol",{className:"text-sm space-y-2 list-decimal list-inside text-muted-foreground ml-6",children:[e.jsx("li",{children:"Enter start and end terminal names in the form"}),e.jsx("li",{children:"Choose a color for your route visualization"}),e.jsx("li",{children:"Click on the map to add stops along your route"}),e.jsx("li",{children:"Drag stops to adjust their positions if needed"}),e.jsx("li",{children:'Click "Save Route" when you have at least 2 stops'})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(he,{size:16,className:"text-green-500"}),e.jsx("h3",{className:"font-medium text-base",children:"Managing Routes"})]}),e.jsxs("ul",{className:"text-sm space-y-2 list-disc list-inside text-muted-foreground ml-6",children:[e.jsx("li",{children:'Use "Show Routes" to view all your saved routes'}),e.jsx("li",{children:'Click "View" to display a specific route on the map'}),e.jsx("li",{children:'Use "Delete" to remove routes you no longer need'}),e.jsx("li",{children:"Routes are displayed with your chosen color on the map"})]})]})]}),e.jsxs("div",{className:"mt-6 pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ge,{size:16,className:"text-purple-500"}),e.jsx("h3",{className:"font-medium text-base",children:"Tips & Best Practices"})]}),e.jsxs("ul",{className:"text-sm space-y-1 list-disc list-inside text-muted-foreground ml-6 grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsx("li",{children:"Add descriptive terminal names for easy identification"}),e.jsx("li",{children:"Use different colors for each route to distinguish them"}),e.jsx("li",{children:"Place stops in logical order along your intended path"}),e.jsx("li",{children:"Test your route by viewing it before finalizing"})]})]})]})]})]})}export{He as default};
