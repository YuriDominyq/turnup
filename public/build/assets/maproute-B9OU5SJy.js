import{u as te,r as c,j as e,a as P,H as se}from"./app-Cexmx4J8.js";import{u as ae,G as le,d as ne,l as re,M as oe,P as ie,I as ce}from"./esm-Bqj_5nt9.js";import{D as K,a as X,b as Q,c as Z,d as de,e as me,f as ue}from"./dialog-BDnZZNsy.js";import{I as O}from"./input-P_T3Hd1m.js";import{B as w,c as D}from"./app-logo-icon-BcPeahl4.js";import{C as B,a as Y,b as J,B as q,c as U}from"./badge-DJIh0JWC.js";import{M as ee}from"./map-pin-DJidTlNc.js";import{E as pe,T as he}from"./trash-2-DlNpqVvP.js";import{L as $}from"./label-DFfmzwg6.js";import{a as ge,S as xe,y as F}from"./app-layout-CLyOzKxs.js";import{R as fe}from"./route-LukHFtYq.js";/* empty css            */import"./createLucideIcon-DQobS5Q3.js";import"./index-uExRE54O.js";import"./index-C55HPdSa.js";import"./users-GxbWeFJj.js";const je={width:"100%",height:"450px"},ye={lat:10.6676,lng:122.9456},Ne=["places","drawing"];function be({stops:r,setStops:n,clearTrigger:f,polylines:m,setPolylines:x,savedPolylines:i,routeColor:p}){const{isLoaded:y}=ae({googleMapsApiKey:"AIzaSyAicbS4J0S5M2DRMdOsImk3FGYFb8tJCPY",libraries:Ne}),{appearance:N}=te(),[C,L]=c.useState(!1),[S,R]=c.useState(null),[k,j]=c.useState(!1),[o,b]=c.useState(null),M=c.useRef([]);c.useEffect(()=>{const l=window.matchMedia("(prefers-color-scheme: dark)").matches;L(N==="dark"||N==="system"&&l)},[N]),c.useEffect(()=>{!i||i.length===0||x(l=>l.length===i.length&&l.every((a,h)=>{const u=i[h];return a.id===u.id&&a.path.length===u.path.length&&a.path.every((s,d)=>s.lat===u.path[d].lat&&s.lng===u.path[d].lng)})?l:i)},[i]),c.useEffect(()=>{f&&(x([]),n([]))},[f,n]),c.useEffect(()=>{if(!S||!i||i.length===0)return;M.current.forEach(t=>t.setMap(null)),M.current=[];const l=new google.maps.LatLngBounds;i.forEach(t=>{const a=t.path.map(u=>{const s=typeof u.lat=="string"?parseFloat(u.lat):u.lat,d=typeof u.lng=="string"?parseFloat(u.lng):u.lng;return l.extend({lat:s,lng:d}),{lat:s,lng:d}}),h=new google.maps.Polyline({path:a,strokeColor:t.color,strokeWeight:3,editable:!1,map:S});M.current.push(h)}),l.isEmpty()||S.fitBounds(l)},[S,i]);const _=l=>{if(!l.latLng)return;const t={lat:l.latLng.lat(),lng:l.latLng.lng()};b({position:t,name:""}),j(!0)},I=()=>{o&&o.name.trim()&&(n([...r,{name:o.name,position:o.position}]),j(!1),b(null))},z=l=>{R(l);const t=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.POLYLINE,drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT,drawingModes:[google.maps.drawing.OverlayType.POLYLINE,google.maps.drawing.OverlayType.MARKER]},polylineOptions:{strokeColor:"#3b82f6",strokeWeight:3,editable:!0,geodesic:!0}});t.setMap(l),google.maps.event.addListener(t,"overlaycomplete",async a=>{if(a.type===google.maps.drawing.OverlayType.POLYLINE){const h=a.overlay,u=h.getPath().getArray().map(d=>({lat:d.lat(),lng:d.lng()})),s={id:Date.now(),path:u,color:p};x(d=>[...d,s]),h.setMap(null)}})};return e.jsxs("div",{className:"flex justify-center py-6",children:[e.jsxs("div",{className:"w-full max-w-6xl rounded-2xl shadow-xl overflow-hidden border border-gray-200 dark:border-gray-700",children:[!y&&e.jsxs("div",{className:"relative h-[450px] flex items-center justify-center bg-gray-100 dark:bg-gray-800 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-blue-500"}),e.jsx("span",{className:"absolute mt-16 text-gray-700 dark:text-gray-200",children:"Loading map..."})]}),y&&e.jsxs(le,{mapContainerStyle:je,center:ye,zoom:12,onClick:_,onLoad:z,options:{styles:C?ne:re,disableDefaultUI:!0,zoomControl:!0,gestureHandling:"greedy"},children:[r.map((l,t)=>e.jsx(oe,{position:l.position,title:l.name,label:{text:`${t+1}`,color:C?"#000000":"#FFFFFF",fontSize:"12px",fontWeight:"bold"},icon:{path:google.maps.SymbolPath.CIRCLE,scale:12,fillColor:C?"#FFD700":"#2196F3",fillOpacity:1,strokeWeight:2,strokeColor:C?"#fff":"#000"}},t)),m.map((l,t)=>e.jsx(ie,{path:l.path,options:{strokeColor:l.color,strokeOpacity:1,strokeWeight:3,editable:!0,geodesic:!0}},t))]})]}),e.jsx(K,{open:k,onOpenChange:l=>{j(l),l||b(null)},children:e.jsxs(X,{children:[e.jsx(Q,{children:e.jsx(Z,{children:"Add Stop"})}),e.jsx(O,{placeholder:"Enter stop name",value:o?.name||"",onChange:l=>b(t=>t?{...t,name:l.target.value}:null)}),e.jsxs(de,{children:[e.jsx(w,{variant:"outline",onClick:()=>{j(!1),b(null)},children:"Cancel"}),e.jsx(w,{onClick:I,disabled:!o?.name.trim(),children:"Save"})]})]})})]})}function we({className:r,...n}){return e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{className:D("w-full caption-bottom text-sm",r),...n})})}function ve({className:r,...n}){return e.jsx("thead",{className:D("[&_tr]:border-b",r),...n})}function Ce({className:r,...n}){return e.jsx("tbody",{className:D("[&_tr:last-child]:border-0",r),...n})}function V({className:r,...n}){return e.jsx("tr",{className:D("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",r),...n})}function G({className:r,...n}){return e.jsx("th",{className:D("h-10 px-2 text-left align-middle font-medium text-muted-foreground",r),...n})}function H({className:r,...n}){return e.jsx("td",{className:D("p-2 align-middle",r),...n})}function Se({routes:r,onView:n,onDelete:f}){return r.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ee,{className:"mx-auto h-12 w-12 text-muted-foreground"}),e.jsx("h3",{className:"mt-2 text-sm font-semibold text-foreground",children:"No Routes"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Get started by creating your first route."})]}):e.jsx("div",{className:"space-y-6",children:r.map((m,x)=>e.jsxs(B,{className:"shadow-md max-w-5xl mx-auto",style:{borderLeftColor:m.color},children:[e.jsx(Y,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs(J,{className:"flex items-center gap-2 text-lg",children:[e.jsx("span",{className:"truncate",children:m.firstTerminal}),e.jsx("span",{className:"text-muted-foreground",children:"→"}),e.jsx("span",{className:"truncate",children:m.secondTerminal})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs(q,{variant:"secondary",className:"text-xs",children:[m.stops.length," stops"]}),e.jsx("div",{className:"w-4 h-4 rounded-full border border-border",style:{backgroundColor:m.color},"aria-label":`Route color: ${m.color}`})]})]}),e.jsxs("div",{className:"flex flex-shrink-0 gap-2",children:[n&&e.jsxs(w,{size:"sm",variant:"outline",onClick:()=>n(m),className:"whitespace-nowrap",children:[e.jsx(pe,{className:"w-4 h-4 mr-1"}),"View"]}),e.jsxs(w,{size:"sm",variant:"destructive",onClick:()=>f(m.id),className:"whitespace-nowrap",children:[e.jsx(he,{className:"w-4 h-4 mr-1"}),"Delete"]})]})]})}),e.jsx(U,{className:"pt-0",children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(we,{children:[e.jsx(ve,{children:e.jsxs(V,{className:"bg-muted/30",children:[e.jsx(G,{className:"font-semibold",children:"#"}),e.jsx(G,{className:"font-semibold",children:"Stop Name"}),e.jsx(G,{className:"font-semibold",children:"Coordinates"})]})}),e.jsx(Ce,{children:m.stops.map((i,p)=>e.jsxs(V,{className:"hover:bg-muted/20",children:[e.jsx(H,{className:"font-medium text-muted-foreground",children:p+1}),e.jsx(H,{className:"font-medium",children:i.name||"Unnamed Stop"}),e.jsx(H,{className:"font-mono text-sm",children:i.lat!=null&&i.lng!=null?`${Number(i.lat).toFixed(5)}, ${Number(i.lng).toFixed(5)}`:"No coordinates"})]},p))})]})})})]},x))})}function ke(){const r=[{name:"Fortune Towne - Central Market",image:"/fortunetowne.jpg"},{name:"Homesite - Central Market",image:"/homesite.jpg"},{name:"Granada - Burgos",image:"/burgosgranada.jpg"}],[n,f]=c.useState(0),[m,x]=c.useState(!1),[i,p]=c.useState({x:0,y:0}),[y,N]=c.useState(null),C=()=>{f(o=>o===0?r.length-1:o-1),x(!1),p({x:0,y:0})},L=()=>{f(o=>o===r.length-1?0:o+1),x(!1),p({x:0,y:0})},S=o=>{m&&(o.preventDefault(),N({x:o.clientX-i.x,y:o.clientY-i.y}))},R=o=>{!m||!y||p({x:o.clientX-y.x,y:o.clientY-y.y})},k=()=>N(null),j=()=>N(null);return e.jsxs(K,{children:[e.jsx(me,{asChild:!0,children:e.jsx(w,{children:"Open Map Guide"})}),e.jsxs(X,{className:"max-w-5xl",children:[e.jsxs(Q,{children:[e.jsx(Z,{className:"text-xl font-semibold text-center",children:"Map Route Guide"}),e.jsx(ue,{className:"text-center",children:"View and navigate through jeepney routes with zoom and pan functionality."})]}),e.jsxs("div",{className:"relative mt-4 flex flex-col items-center overflow-hidden w-full max-h-[600px] rounded-lg",onMouseMove:R,onMouseUp:k,onMouseLeave:j,children:[e.jsx("img",{src:r[n].image,alt:r[n].name,className:`object-cover cursor-${m?"grab":"zoom-in"} transition-transform duration-300`,style:{width:"100%",maxHeight:"600px",transform:`scale(${m?2:1}) translate(${i.x/(m?2:1)}px, ${i.y/(m?2:1)}px)`,cursor:m?"grab":"zoom-in"},onClick:()=>x(o=>!o),onMouseDown:S}),e.jsx("p",{className:"mt-4 text-center text-lg font-medium",children:r[n].name}),e.jsxs("div",{className:"absolute top-1/2 w-full flex justify-between px-6 -translate-y-1/2",children:[e.jsx(w,{variant:"outline",size:"lg",onClick:C,children:"◀"}),e.jsx(w,{variant:"outline",size:"lg",onClick:L,children:"▶"})]})]})]})]})}const Re=[{title:"Map Route",href:"/maproute"}];function Ye(){const[r,n]=c.useState([]),[f,m]=c.useState(""),[x,i]=c.useState(""),[p,y]=c.useState([]),[N,C]=c.useState(!0),[L,S]=c.useState(!1),[R,k]=c.useState([]),[j,o]=c.useState(null),[b,M]=c.useState("#3388ff");c.useEffect(()=>{P.get("https://turnup-admin.com/sanctum/csrf-cookie",{withCredentials:!0}).then(()=>console.log("CSRF cookie set")).catch(t=>console.error(t))},[]),c.useEffect(()=>{(async()=>{try{const h=await(await fetch("/routes")).json(),u=await Promise.all(h.map(async(s,d)=>{let v=[];if(typeof s.polyline=="string")try{v=JSON.parse(s.polyline).map(E=>({lat:Number(E.lat),lng:Number(E.lng)}))}catch{v=[]}else Array.isArray(s.polyline)?v=s.polyline.map(g=>({lat:Number(g.lat),lng:Number(g.lng)})):s.polyline&&(v=[{lat:Number(s.polyline.lat),lng:Number(s.polyline.lng)}]);const T=await z(v.map(g=>({lat:Number(g.lat),lng:Number(g.lng)})));return{id:s.id??d,firstTerminal:s.first_terminal,secondTerminal:s.second_terminal,polyline:T,stops:s.stops.map(g=>({name:g.name,lat:Number(g.lat),lng:Number(g.lng)})),color:s.color??"#3388ff"}}));n(u)}catch(a){console.error("Failed to fetch routes",a)}})()},[]);const _=async()=>{if(!f||!x){F.error("Please fill in both terminals");return}if(p.length<2){F.error("Please add at least 2 stops before saving the route");return}try{await P.get("https://turnup-admin.com/sanctum/csrf-cookie",{withCredentials:!0});const t={first_terminal:f,second_terminal:x,polyline:R[0]?.path??[],stops:p.map(s=>({name:s.name,lat:s.position.lat,lng:s.position.lng})),color:b},a=await P.post("https://turnup-admin.com/routes",t,{withCredentials:!0});let h=[];if(typeof a.data.polyline=="string")try{h=JSON.parse(a.data.polyline).map(d=>({lat:Number(d.lat),lng:Number(d.lng)}))}catch{h=[]}else Array.isArray(a.data.polyline)?h=a.data.polyline.map(s=>({lat:Number(s.lat),lng:Number(s.lng)})):a.data.polyline&&(h=[{lat:Number(a.data.polyline.lat),lng:Number(a.data.polyline.lng)}]);const u={id:a.data.id??Date.now(),firstTerminal:a.data.first_terminal,secondTerminal:a.data.second_terminal,polyline:h.map(s=>({lat:Number(s.lat),lng:Number(s.lng)})),stops:a.data.stops.map(s=>({name:s.name,lat:Number(s.lat),lng:Number(s.lng)})),color:"#3388ff"};n(s=>[...s,u]),m(""),i(""),y([]),F.success("Route added successfully")}catch(t){F.error("Failed to save route."),console.log(t)}},I=async t=>{try{await P.delete(`https://turnup-admin.com/routes/${t}`,{withCredentials:!0}),n(a=>a.filter(h=>h.id!==t)),j?.id===t&&(o(null),y([]),k([])),F.success("Delete Route Successfully")}catch(a){console.error("Failed to delete route",a),F.error("Failed to delete route.")}},z=async t=>{if(t.length===0)return[];const a=t.filter(d=>!isNaN(d.lat)&&!isNaN(d.lng));if(a.length===0)return[];const u=((d,v)=>{const T=[];for(let g=0;g<d.length;g+=v)T.push(d.slice(g,g+v));return T})(a,100);let s=[];for(const d of u){const T=`https://roads.googleapis.com/v1/snapToRoads?path=${d.map(A=>`${A.lat},${A.lng}`).join("|")}&interpolate=true&key=AIzaSyAicbS4J0S5M2DRMdOsImk3FGYFb8tJCPY`,E=await(await fetch(T)).json();if(E.snappedPoints){const A=E.snappedPoints.map(W=>({lat:W.location.latitude,lng:W.location.longitude}));s=[...s,...A]}}return s},l=f&&x&&p.length>=2;return e.jsxs(ge,{breadcrumbs:Re,children:[e.jsx(se,{title:"Map Route"}),e.jsxs(B,{className:"w-full max-w-4xl mx-auto m-6",children:[e.jsx(Y,{children:e.jsxs(J,{className:"flex items-center justify-between",children:["Create Route",e.jsxs(q,{variant:l?"default":"secondary",children:[p.length," stops"]})]})}),e.jsxs(U,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"first_terminal",children:"First Terminal"}),e.jsx(O,{id:"first_terminal",name:"firstTerminal",placeholder:"First Terminal",value:f,onChange:t=>m(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"second_terminal",children:"Second Terminal"}),e.jsx(O,{id:"second_terminal",name:"secondTerminal",placeholder:"Second Terminal",value:x,onChange:t=>i(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"route_color",children:"Route Color"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{type:"color",id:"route_color",value:b,onChange:t=>M(t.target.value),className:"w-12 h-10 p-1 cursor-pointer"}),e.jsx(O,{type:"text",value:b,onChange:t=>M(t.target.value),placeholder:"#3b82f6",className:"flex-1"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-lg bg-muted/30",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${p.length<2?"bg-orange-400":"bg-green-400"}`}),e.jsx("p",{className:"text-sm text-muted-foreground",children:p.length<2?"Add at least 2 stops to save and draw routes.":"Ready to save the route"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:[e.jsx(w,{onClick:_,disabled:!f||!x||p.length<2,children:"Save Route"}),e.jsx(w,{variant:"destructive",onClick:()=>S(t=>!t),disabled:p.length===0,children:"Clear Route"}),e.jsx(ke,{})]})]})]}),e.jsx("div",{className:"mt-6",children:e.jsx(be,{stops:p,setStops:y,clearTrigger:L,polylines:R,setPolylines:k,savedPolylines:j?[{id:j.id,path:j.polyline,color:j.color??"#3388ff"}]:[],snapToRoad:z,routeColor:b})}),e.jsx("div",{className:"m-4",children:e.jsx(w,{onClick:()=>C(!N),children:N?"Hide Routes Table":"Show Routes Table"})}),N&&e.jsx(Se,{routes:r,onView:t=>{j?.id===t.id?(o(null),y([]),k([])):(y(t.stops.map(a=>({name:a.name,position:{lat:a.lat,lng:a.lng}}))),k([{id:t.id,path:t.polyline,color:t.color}]),o(t))},onDelete:I}),e.jsxs(B,{className:"m-10",children:[e.jsx(Y,{className:"pb-3",children:e.jsxs(J,{className:"flex items-center gap-2 text-lg",children:[e.jsx(ce,{size:18}),"Quick Start Guide"]})}),e.jsxs(U,{className:"pt-0",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ee,{size:16,className:"text-blue-500"}),e.jsx("h3",{className:"font-medium text-base",children:"Creating a Route"})]}),e.jsxs("ol",{className:"text-sm space-y-2 list-decimal list-inside text-muted-foreground ml-6",children:[e.jsx("li",{children:"Enter start and end terminal names in the form"}),e.jsx("li",{children:"Choose a color for your route visualization"}),e.jsx("li",{children:"Click on the map to add stops along your route"}),e.jsx("li",{children:"Drag stops to adjust their positions if needed"}),e.jsx("li",{children:'Click "Save Route" when you have at least 2 stops'})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(xe,{size:16,className:"text-green-500"}),e.jsx("h3",{className:"font-medium text-base",children:"Managing Routes"})]}),e.jsxs("ul",{className:"text-sm space-y-2 list-disc list-inside text-muted-foreground ml-6",children:[e.jsx("li",{children:'Use "Show Routes" to view all your saved routes'}),e.jsx("li",{children:'Click "View" to display a specific route on the map'}),e.jsx("li",{children:'Use "Delete" to remove routes you no longer need'}),e.jsx("li",{children:"Routes are displayed with your chosen color on the map"})]})]})]}),e.jsxs("div",{className:"mt-6 pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(fe,{size:16,className:"text-purple-500"}),e.jsx("h3",{className:"font-medium text-base",children:"Tips & Best Practices"})]}),e.jsxs("ul",{className:"text-sm space-y-1 list-disc list-inside text-muted-foreground ml-6 grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsx("li",{children:"Add descriptive terminal names for easy identification"}),e.jsx("li",{children:"Use different colors for each route to distinguish them"}),e.jsx("li",{children:"Place stops in logical order along your intended path"}),e.jsx("li",{children:"Test your route by viewing it before finalizing"})]})]})]})]})]})}export{Ye as default};
