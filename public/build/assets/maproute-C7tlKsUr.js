import{b as Q,r as o,j as e,a as E,H as Z}from"./app-d9SgxdQS.js";import{u as ee,G as se,d as te,l as ae,M as le,P as ne,I as re}from"./esm-CMq2IwKz.js";import{D as J,a as U,b as W,c as V,d as oe,e as ie,f as ce}from"./dialog-BmHxW5Ji.js";import{I as D}from"./input-uMQZdMB5.js";import{B as v}from"./app-logo-icon-CPYCTx_O.js";import{C as _,a as $,b as H,B as K,c as G}from"./card-DYwXZ9vT.js";import{T as de,a as me,b as Y,c as A,d as ue,e as I}from"./table-B2redkif.js";import{M as X}from"./map-pin-BJKHSU_Q.js";import{E as pe,T as he}from"./trash-2-CxmYNVhc.js";import{L as P}from"./label-Xfo8vVzI.js";import{A as ge,S as xe,y as T}from"./app-layout-LWcGx1ZE.js";import{c as fe}from"./createLucideIcon-C3SxUK1l.js";/* empty css            */import"./index-BvyCzCKY.js";import"./index-BkHP6GWz.js";import"./users-Pwk57gk4.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]],ye=fe("Route",je),Ne={width:"100%",height:"450px"},be={lat:10.6676,lng:122.9456},we=["places","drawing"];function ve({stops:x,setStops:h,clearTrigger:f,polylines:i,setPolylines:p,savedPolylines:r,routeColor:d}){const{isLoaded:y}=ee({googleMapsApiKey:"AIzaSyAicbS4J0S5M2DRMdOsImk3FGYFb8tJCPY",libraries:we}),{appearance:N}=Q(),[C,F]=o.useState(!1),[S,R]=o.useState(null),[k,j]=o.useState(!1),[n,b]=o.useState(null),M=o.useRef([]);o.useEffect(()=>{const l=window.matchMedia("(prefers-color-scheme: dark)").matches;F(N==="dark"||N==="system"&&l)},[N]),o.useEffect(()=>{!r||r.length===0||p(l=>l.length===r.length&&l.every((a,u)=>{const c=r[u];return a.id===c.id&&a.path.length===c.path.length&&a.path.every((t,m)=>t.lat===c.path[m].lat&&t.lng===c.path[m].lng)})?l:r)},[r]),o.useEffect(()=>{f&&(p([]),h([]))},[f,h]),o.useEffect(()=>{if(!S||!r||r.length===0)return;M.current.forEach(s=>s.setMap(null)),M.current=[];const l=new google.maps.LatLngBounds;r.forEach(s=>{const a=s.path.map(c=>{const t=typeof c.lat=="string"?parseFloat(c.lat):c.lat,m=typeof c.lng=="string"?parseFloat(c.lng):c.lng;return l.extend({lat:t,lng:m}),{lat:t,lng:m}}),u=new google.maps.Polyline({path:a,strokeColor:s.color,strokeWeight:3,editable:!1,map:S});M.current.push(u)}),l.isEmpty()||S.fitBounds(l)},[S,r]);const O=l=>{if(!l.latLng)return;const s={lat:l.latLng.lat(),lng:l.latLng.lng()};b({position:s,name:""}),j(!0)},z=()=>{n&&n.name.trim()&&(h([...x,{name:n.name,position:n.position}]),j(!1),b(null))},L=l=>{R(l);const s=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.POLYLINE,drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT,drawingModes:[google.maps.drawing.OverlayType.POLYLINE,google.maps.drawing.OverlayType.MARKER]},polylineOptions:{strokeColor:"#3b82f6",strokeWeight:3,editable:!0,geodesic:!0}});s.setMap(l),google.maps.event.addListener(s,"overlaycomplete",async a=>{if(a.type===google.maps.drawing.OverlayType.POLYLINE){const u=a.overlay,c=u.getPath().getArray().map(m=>({lat:m.lat(),lng:m.lng()})),t={id:Date.now(),path:c,color:d};p(m=>[...m,t]),u.setMap(null)}})};return e.jsxs("div",{className:"flex justify-center py-6",children:[e.jsxs("div",{className:"w-full max-w-6xl rounded-2xl shadow-xl overflow-hidden border border-gray-200 dark:border-gray-700",children:[!y&&e.jsxs("div",{className:"relative h-[450px] flex items-center justify-center bg-gray-100 dark:bg-gray-800 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-blue-500"}),e.jsx("span",{className:"absolute mt-16 text-gray-700 dark:text-gray-200",children:"Loading map..."})]}),y&&e.jsxs(se,{mapContainerStyle:Ne,center:be,zoom:12,onClick:O,onLoad:L,options:{styles:C?te:ae,disableDefaultUI:!0,zoomControl:!0,gestureHandling:"greedy"},children:[x.map((l,s)=>e.jsx(le,{position:l.position,title:l.name,label:{text:`${s+1}`,color:C?"#000000":"#FFFFFF",fontSize:"12px",fontWeight:"bold"},icon:{path:google.maps.SymbolPath.CIRCLE,scale:12,fillColor:C?"#FFD700":"#2196F3",fillOpacity:1,strokeWeight:2,strokeColor:C?"#fff":"#000"}},s)),i.map((l,s)=>e.jsx(ne,{path:l.path,options:{strokeColor:l.color,strokeOpacity:1,strokeWeight:3,editable:!0,geodesic:!0}},s))]})]}),e.jsx(J,{open:k,onOpenChange:l=>{j(l),l||b(null)},children:e.jsxs(U,{children:[e.jsx(W,{children:e.jsx(V,{children:"Add Stop"})}),e.jsx(D,{placeholder:"Enter stop name",value:n?.name||"",onChange:l=>b(s=>s?{...s,name:l.target.value}:null)}),e.jsxs(oe,{children:[e.jsx(v,{variant:"outline",onClick:()=>{j(!1),b(null)},children:"Cancel"}),e.jsx(v,{onClick:z,disabled:!n?.name.trim(),children:"Save"})]})]})})]})}function Ce({routes:x,onView:h,onDelete:f}){return x.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(X,{className:"mx-auto h-12 w-12 text-muted-foreground"}),e.jsx("h3",{className:"mt-2 text-sm font-semibold text-foreground",children:"No Routes"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Get started by creating your first route."})]}):e.jsx("div",{className:"space-y-6",children:x.map((i,p)=>e.jsxs(_,{className:"shadow-md max-w-5xl mx-auto",style:{borderLeftColor:i.color},children:[e.jsx($,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs(H,{className:"flex items-center gap-2 text-lg",children:[e.jsx("span",{className:"truncate",children:i.firstTerminal}),e.jsx("span",{className:"text-muted-foreground",children:"→"}),e.jsx("span",{className:"truncate",children:i.secondTerminal})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs(K,{variant:"secondary",className:"text-xs",children:[i.stops.length," stops"]}),e.jsx("div",{className:"w-4 h-4 rounded-full border border-border",style:{backgroundColor:i.color},"aria-label":`Route color: ${i.color}`})]})]}),e.jsxs("div",{className:"flex flex-shrink-0 gap-2",children:[h&&e.jsxs(v,{size:"sm",variant:"outline",onClick:()=>h(i),className:"whitespace-nowrap",children:[e.jsx(pe,{className:"w-4 h-4 mr-1"}),"View"]}),e.jsxs(v,{size:"sm",variant:"destructive",onClick:()=>f(i.id),className:"whitespace-nowrap",children:[e.jsx(he,{className:"w-4 h-4 mr-1"}),"Delete"]})]})]})}),e.jsx(G,{className:"pt-0",children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(de,{children:[e.jsx(me,{children:e.jsxs(Y,{className:"bg-muted/30",children:[e.jsx(A,{className:"font-semibold",children:"#"}),e.jsx(A,{className:"font-semibold",children:"Stop Name"}),e.jsx(A,{className:"font-semibold",children:"Coordinates"})]})}),e.jsx(ue,{children:i.stops.map((r,d)=>e.jsxs(Y,{className:"hover:bg-muted/20",children:[e.jsx(I,{className:"font-medium text-muted-foreground",children:d+1}),e.jsx(I,{className:"font-medium",children:r.name||"Unnamed Stop"}),e.jsx(I,{className:"font-mono text-sm",children:r.lat!=null&&r.lng!=null?`${Number(r.lat).toFixed(5)}, ${Number(r.lng).toFixed(5)}`:"No coordinates"})]},d))})]})})})]},p))})}function Se(){const x=[{name:"Fortune Towne - Central Market",image:"/fortunetowne.jpg"},{name:"Homesite - Central Market",image:"/homesite.jpg"},{name:"Granada - Burgos",image:"/burgosgranada.jpg"}],[h,f]=o.useState(0),[i,p]=o.useState(!1),[r,d]=o.useState({x:0,y:0}),[y,N]=o.useState(null),C=()=>{f(n=>n===0?x.length-1:n-1),p(!1),d({x:0,y:0})},F=()=>{f(n=>n===x.length-1?0:n+1),p(!1),d({x:0,y:0})},S=n=>{i&&(n.preventDefault(),N({x:n.clientX-r.x,y:n.clientY-r.y}))},R=n=>{!i||!y||d({x:n.clientX-y.x,y:n.clientY-y.y})},k=()=>N(null),j=()=>N(null);return e.jsxs(J,{children:[e.jsx(ie,{asChild:!0,children:e.jsx(v,{children:"Open Map Guide"})}),e.jsxs(U,{className:"max-w-5xl",children:[e.jsxs(W,{children:[e.jsx(V,{className:"text-xl font-semibold text-center",children:"Map Route Guide"}),e.jsx(ce,{className:"text-center",children:"View and navigate through jeepney routes with zoom and pan functionality."})]}),e.jsxs("div",{className:"relative mt-4 flex flex-col items-center overflow-hidden w-full max-h-[600px] rounded-lg",onMouseMove:R,onMouseUp:k,onMouseLeave:j,children:[e.jsx("img",{src:x[h].image,alt:x[h].name,className:`object-cover cursor-${i?"grab":"zoom-in"} transition-transform duration-300`,style:{width:"100%",maxHeight:"600px",transform:`scale(${i?2:1}) translate(${r.x/(i?2:1)}px, ${r.y/(i?2:1)}px)`,cursor:i?"grab":"zoom-in"},onClick:()=>p(n=>!n),onMouseDown:S}),e.jsx("p",{className:"mt-4 text-center text-lg font-medium",children:x[h].name}),e.jsxs("div",{className:"absolute top-1/2 w-full flex justify-between px-6 -translate-y-1/2",children:[e.jsx(v,{variant:"outline",size:"lg",onClick:C,children:"◀"}),e.jsx(v,{variant:"outline",size:"lg",onClick:F,children:"▶"})]})]})]})]})}const ke=[{title:"Map Route",href:"/maproute"}];function Be(){const[x,h]=o.useState([]),[f,i]=o.useState(""),[p,r]=o.useState(""),[d,y]=o.useState([]),[N,C]=o.useState(!0),[F,S]=o.useState(!1),[R,k]=o.useState([]),[j,n]=o.useState(null),[b,M]=o.useState("#3388ff");o.useEffect(()=>{E.get("https://turnup-admin.com/sanctum/csrf-cookie",{withCredentials:!0}).then(()=>console.log("CSRF cookie set")).catch(s=>console.error(s))},[]),o.useEffect(()=>{(async()=>{try{const u=await(await fetch("/routes")).json(),c=await Promise.all(u.map(async(t,m)=>{let g=[];if(typeof t.polyline=="string")try{g=JSON.parse(t.polyline).map(B=>({lat:Number(B.lat),lng:Number(B.lng)}))}catch{g=[]}else Array.isArray(t.polyline)?g=t.polyline.map(w=>({lat:Number(w.lat),lng:Number(w.lng)})):t.polyline&&(g=[{lat:Number(t.polyline.lat),lng:Number(t.polyline.lng)}]);const q=await L(g.map(w=>({lat:Number(w.lat),lng:Number(w.lng)})));return{id:t.id??m,firstTerminal:t.first_terminal,secondTerminal:t.second_terminal,polyline:q,stops:t.stops.map(w=>({name:w.name,lat:Number(w.lat),lng:Number(w.lng)})),color:t.color??"#3388ff"}}));h(c)}catch(a){console.error("Failed to fetch routes",a)}})()},[]);const O=async()=>{if(!f||!p){T.error("Please fill in both terminals");return}if(d.length<2){T.error("Please add at least 2 stops before saving the route");return}try{await E.get("https://turnup-admin.com/sanctum/csrf-cookie",{withCredentials:!0});const s={first_terminal:f,second_terminal:p,polyline:R[0]?.path??[],stops:d.map(t=>({name:t.name,lat:t.position.lat,lng:t.position.lng})),color:b},a=await E.post("https://turnup-admin.com/routes",s,{withCredentials:!0});let u=[];if(typeof a.data.polyline=="string")try{u=JSON.parse(a.data.polyline).map(m=>({lat:Number(m.lat),lng:Number(m.lng)}))}catch{u=[]}else Array.isArray(a.data.polyline)?u=a.data.polyline.map(t=>({lat:Number(t.lat),lng:Number(t.lng)})):a.data.polyline&&(u=[{lat:Number(a.data.polyline.lat),lng:Number(a.data.polyline.lng)}]);const c={id:a.data.id??Date.now(),firstTerminal:a.data.first_terminal,secondTerminal:a.data.second_terminal,polyline:u.map(t=>({lat:Number(t.lat),lng:Number(t.lng)})),stops:a.data.stops.map(t=>({name:t.name,lat:Number(t.lat),lng:Number(t.lng)})),color:"#3388ff"};h(t=>[...t,c]),i(""),r(""),y([]),T.success("Route added successfully")}catch(s){T.error("Failed to save route."),console.log(s)}},z=async s=>{try{await E.delete(`https://turnup-admin.com/routes/${s}`,{withCredentials:!0}),h(a=>a.filter(u=>u.id!==s)),j?.id===s&&(n(null),y([]),k([])),T.success("Delete Route Successfully")}catch(a){console.error("Failed to delete route",a),T.error("Failed to delete route.")}},L=async s=>{if(s.length===0)return[];const a=s.filter(g=>!isNaN(g.lat)&&!isNaN(g.lng));if(a.length===0)return[];const c=`https://roads.googleapis.com/v1/snapToRoads?path=${a.map(g=>`${g.lat},${g.lng}`).join("|")}&interpolate=true&key=AIzaSyAicbS4J0S5M2DRMdOsImk3FGYFb8tJCPY`,m=await(await fetch(c)).json();return m.snappedPoints?m.snappedPoints.map(g=>({lat:g.location.latitude,lng:g.location.longitude})):[]},l=f&&p&&d.length>=2;return e.jsxs(ge,{breadcrumbs:ke,children:[e.jsx(Z,{title:"Map Route"}),e.jsxs(_,{className:"w-full max-w-4xl mx-auto m-6",children:[e.jsx($,{children:e.jsxs(H,{className:"flex items-center justify-between",children:["Create Route",e.jsxs(K,{variant:l?"default":"secondary",children:[d.length," stops"]})]})}),e.jsxs(G,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"first_terminal",children:"First Terminal"}),e.jsx(D,{id:"first_terminal",name:"firstTerminal",placeholder:"First Terminal",value:f,onChange:s=>i(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"second_terminal",children:"Second Terminal"}),e.jsx(D,{id:"second_terminal",name:"secondTerminal",placeholder:"Second Terminal",value:p,onChange:s=>r(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"route_color",children:"Route Color"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{type:"color",id:"route_color",value:b,onChange:s=>M(s.target.value),className:"w-12 h-10 p-1 cursor-pointer"}),e.jsx(D,{type:"text",value:b,onChange:s=>M(s.target.value),placeholder:"#3b82f6",className:"flex-1"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-lg bg-muted/30",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${d.length<2?"bg-orange-400":"bg-green-400"}`}),e.jsx("p",{className:"text-sm text-muted-foreground",children:d.length<2?"Add at least 2 stops to save and draw routes.":"Ready to save the route"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:[e.jsx(v,{onClick:O,disabled:!f||!p||d.length<2,children:"Save Route"}),e.jsx(v,{variant:"destructive",onClick:()=>S(s=>!s),disabled:d.length===0,children:"Clear Route"}),e.jsx(Se,{})]})]})]}),e.jsx("div",{className:"mt-6",children:e.jsx(ve,{stops:d,setStops:y,clearTrigger:F,polylines:R,setPolylines:k,savedPolylines:j?[{id:j.id,path:j.polyline,color:j.color??"#3388ff"}]:[],snapToRoad:L,routeColor:b})}),e.jsx("div",{className:"m-4",children:e.jsx(v,{onClick:()=>C(!N),children:N?"Hide Routes Table":"Show Routes Table"})}),N&&e.jsx(Ce,{routes:x,onView:s=>{j?.id===s.id?(n(null),y([]),k([])):(y(s.stops.map(a=>({name:a.name,position:{lat:a.lat,lng:a.lng}}))),k([{id:s.id,path:s.polyline,color:s.color}]),n(s))},onDelete:z}),e.jsxs(_,{className:"m-10",children:[e.jsx($,{className:"pb-3",children:e.jsxs(H,{className:"flex items-center gap-2 text-lg",children:[e.jsx(re,{size:18}),"Quick Start Guide"]})}),e.jsxs(G,{className:"pt-0",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(X,{size:16,className:"text-blue-500"}),e.jsx("h3",{className:"font-medium text-base",children:"Creating a Route"})]}),e.jsxs("ol",{className:"text-sm space-y-2 list-decimal list-inside text-muted-foreground ml-6",children:[e.jsx("li",{children:"Enter start and end terminal names in the form"}),e.jsx("li",{children:"Choose a color for your route visualization"}),e.jsx("li",{children:"Click on the map to add stops along your route"}),e.jsx("li",{children:"Drag stops to adjust their positions if needed"}),e.jsx("li",{children:'Click "Save Route" when you have at least 2 stops'})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(xe,{size:16,className:"text-green-500"}),e.jsx("h3",{className:"font-medium text-base",children:"Managing Routes"})]}),e.jsxs("ul",{className:"text-sm space-y-2 list-disc list-inside text-muted-foreground ml-6",children:[e.jsx("li",{children:'Use "Show Routes" to view all your saved routes'}),e.jsx("li",{children:'Click "View" to display a specific route on the map'}),e.jsx("li",{children:'Use "Delete" to remove routes you no longer need'}),e.jsx("li",{children:"Routes are displayed with your chosen color on the map"})]})]})]}),e.jsxs("div",{className:"mt-6 pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ye,{size:16,className:"text-purple-500"}),e.jsx("h3",{className:"font-medium text-base",children:"Tips & Best Practices"})]}),e.jsxs("ul",{className:"text-sm space-y-1 list-disc list-inside text-muted-foreground ml-6 grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsx("li",{children:"Add descriptive terminal names for easy identification"}),e.jsx("li",{children:"Use different colors for each route to distinguish them"}),e.jsx("li",{children:"Place stops in logical order along your intended path"}),e.jsx("li",{children:"Test your route by viewing it before finalizing"})]})]})]})]})]})}export{Be as default};
