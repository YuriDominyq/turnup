import{u as ce,r as i,j as e,a as I,H as de}from"./app-B98Yf_z0.js";import{u as me,G as ue,d as he,l as pe,M as xe,P as ge,I as fe}from"./esm-BN45ZZus.js";import{D as ee,a as te,b as se,c as ae,d as je,e as ye,f as Ne}from"./dialog-Baq-DARa.js";import{I as $}from"./input-Cz2Te2B4.js";import{B as v,c as z}from"./app-logo-icon-8C4KUhaW.js";import{C as B,a as Y,b as V,c as Q}from"./card-DeDP9tQ1.js";import{B as le}from"./badge-BFa5wWhs.js";import{S as ne,a as re,b as oe,c as ie,d as F}from"./select-Cv4PBfdt.js";import{M as J}from"./map-pin-Bbn-r342.js";import{E as be,T as ve}from"./trash-2-CqO9E7fF.js";import{L as H}from"./label-Dl9Rm445.js";import{a as we,S as Se,y as M}from"./app-layout-ctrc7RCi.js";import{R as Ce}from"./route-B5ofwvhP.js";/* empty css            */import"./createLucideIcon-BHqsKdKb.js";import"./index-B8CjOCKK.js";import"./index-CCEdu_K7.js";import"./index-BloeWOk6.js";import"./users-DHu7KlI8.js";const Re={width:"100%",height:"450px"},Te={lat:10.6676,lng:122.9456},ke=["places","drawing"];function Me({stops:c,setStops:r,clearTrigger:y,polylines:j,setPolylines:p,savedPolylines:u,routeColor:h}){const{isLoaded:l}=me({googleMapsApiKey:"AIzaSyAicbS4J0S5M2DRMdOsImk3FGYFb8tJCPY",libraries:ke}),{appearance:x}=ce(),[b,O]=i.useState(!1),[R,D]=i.useState(null),[T,g]=i.useState(!1),[d,w]=i.useState(null),E=i.useRef([]);i.useEffect(()=>{const n=window.matchMedia("(prefers-color-scheme: dark)").matches;O(x==="dark"||x==="system"&&n)},[x]),i.useEffect(()=>{!u||u.length===0||p(n=>n.length===u.length&&n.every((S,k)=>{const t=u[k];return S.id===t.id&&S.path.length===t.path.length&&S.path.every((s,o)=>s.lat===t.path[o].lat&&s.lng===t.path[o].lng)})?n:u)},[u]),i.useEffect(()=>{y&&(p([]),r([]))},[y,r]),i.useEffect(()=>{if(!R||!u||u.length===0)return;E.current.forEach(m=>m.setMap(null)),E.current=[];const n=new google.maps.LatLngBounds;u.forEach(m=>{const S=m.path.map(t=>{const s=typeof t.lat=="string"?parseFloat(t.lat):t.lat,o=typeof t.lng=="string"?parseFloat(t.lng):t.lng;return n.extend({lat:s,lng:o}),{lat:s,lng:o}}),k=new google.maps.Polyline({path:S,strokeColor:m.color,strokeWeight:3,editable:!1,map:R});E.current.push(k)}),n.isEmpty()||R.fitBounds(n)},[R,u]);const A=n=>{if(!n.latLng)return;const m={lat:n.latLng.lat(),lng:n.latLng.lng()};w({position:m,name:""}),g(!0)},U=()=>{d&&d.name.trim()&&(r([...c,{name:d.name,position:d.position}]),g(!1),w(null))},W=n=>{D(n);const m=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.POLYLINE,drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT,drawingModes:[google.maps.drawing.OverlayType.POLYLINE,google.maps.drawing.OverlayType.MARKER]},polylineOptions:{strokeColor:"#3b82f6",strokeWeight:3,editable:!0,geodesic:!0}});m.setMap(n),google.maps.event.addListener(m,"overlaycomplete",async S=>{if(S.type===google.maps.drawing.OverlayType.POLYLINE){const k=S.overlay,t=k.getPath().getArray().map(o=>({lat:o.lat(),lng:o.lng()})),s={id:Date.now(),path:t,color:h};p(o=>[...o,s]),k.setMap(null)}})};return e.jsxs("div",{className:"flex justify-center py-6",children:[e.jsxs("div",{className:"w-full max-w-6xl rounded-2xl shadow-xl overflow-hidden border border-gray-200 dark:border-gray-700",children:[!l&&e.jsxs("div",{className:"relative h-[450px] flex items-center justify-center bg-gray-100 dark:bg-gray-800 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-blue-500"}),e.jsx("span",{className:"absolute mt-16 text-gray-700 dark:text-gray-200",children:"Loading map..."})]}),l&&e.jsxs(ue,{mapContainerStyle:Re,center:Te,zoom:12,onClick:A,onLoad:W,options:{styles:b?he:pe,disableDefaultUI:!0,zoomControl:!0,gestureHandling:"greedy"},children:[c.map((n,m)=>e.jsx(xe,{position:n.position,title:n.name,label:{text:`${m+1}`,color:b?"#000000":"#FFFFFF",fontSize:"12px",fontWeight:"bold"},icon:{path:google.maps.SymbolPath.CIRCLE,scale:12,fillColor:b?"#FFD700":"#2196F3",fillOpacity:1,strokeWeight:2,strokeColor:b?"#fff":"#000"}},m)),j.map((n,m)=>e.jsx(ge,{path:n.path,options:{strokeColor:n.color,strokeOpacity:1,strokeWeight:3,editable:!0,geodesic:!0}},m))]})]}),e.jsx(ee,{open:T,onOpenChange:n=>{g(n),n||w(null)},children:e.jsxs(te,{children:[e.jsx(se,{children:e.jsx(ae,{children:"Add Stop"})}),e.jsx($,{placeholder:"Enter stop name",value:d?.name||"",onChange:n=>w(m=>m?{...m,name:n.target.value}:null)}),e.jsxs(je,{children:[e.jsx(v,{variant:"outline",onClick:()=>{g(!1),w(null)},children:"Cancel"}),e.jsx(v,{onClick:U,disabled:!d?.name.trim(),children:"Save"})]})]})})]})}function Fe({className:c,...r}){return e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{className:z("w-full caption-bottom text-sm",c),...r})})}function De({className:c,...r}){return e.jsx("thead",{className:z("[&_tr]:border-b",c),...r})}function Ee({className:c,...r}){return e.jsx("tbody",{className:z("[&_tr:last-child]:border-0",c),...r})}function q({className:c,...r}){return e.jsx("tr",{className:z("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",c),...r})}function K({className:c,...r}){return e.jsx("th",{className:z("h-10 px-2 text-left align-middle font-medium text-muted-foreground",c),...r})}function X({className:c,...r}){return e.jsx("td",{className:z("p-2 align-middle",c),...r})}function Le({routes:c,onView:r,onDelete:y,onToggleDisable:j}){const[p,u]=i.useState("main"),h=c.filter(l=>l.type===p);return c.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(J,{className:"mx-auto h-12 w-12 text-muted-foreground"}),e.jsx("h3",{className:"mt-2 text-sm font-semibold text-foreground",children:"No Routes"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Get started by creating your first route."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs(ne,{value:p,onValueChange:l=>u(l),children:[e.jsx(re,{children:e.jsx(oe,{placeholder:"Select Route Type"})}),e.jsxs(ie,{children:[e.jsx(F,{value:"main",children:"Main"}),e.jsx(F,{value:"festival",children:"Festival"}),e.jsx(F,{value:"detour",children:"Detour"}),e.jsx(F,{value:"emergency",children:"Emergency"})]})]})}),h.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(J,{className:"mx-auto h-12 w-12 text-muted-foreground"}),e.jsx("h3",{className:"mt-2 text-sm font-semibold text-foreground",children:"No Routes"}),e.jsxs("p",{className:"mt-1 text-sm text-muted-foreground",children:["No ",p," routes available."]})]}),h.map(l=>e.jsxs(B,{className:"shadow-md max-w-5xl mx-auto",style:{borderLeftColor:l.color},children:[e.jsx(Y,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs(V,{className:"flex items-center gap-2 text-lg",children:[e.jsx("span",{className:"truncate",children:l.firstTerminal}),e.jsx("span",{className:"text-muted-foreground",children:"→"}),e.jsx("span",{className:"truncate",children:l.secondTerminal})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs(le,{variant:"secondary",className:"text-xs",children:[l.stops.length," stops"]}),e.jsx("div",{className:"w-4 h-4 rounded-full border border-border",style:{backgroundColor:l.color},"aria-label":`Route color: ${l.color}`})]})]}),e.jsxs("div",{className:"flex flex-shrink-0 gap-2",children:[r&&e.jsxs(v,{size:"sm",variant:"outline",onClick:()=>r(l),className:"whitespace-nowrap",children:[e.jsx(be,{className:"w-4 h-4 mr-1"}),"View"]}),j&&e.jsx(v,{size:"sm",variant:l.disabled?"outline":"secondary",onClick:()=>j(l.id),className:"whitespace-nowrap",children:l.disabled?"Enable":"Disable"}),e.jsxs(v,{size:"sm",variant:"destructive",onClick:()=>y(l.id),className:"whitespace-nowrap",children:[e.jsx(ve,{className:"w-4 h-4 mr-1"}),"Delete"]})]})]})}),e.jsx(Q,{className:"pt-0",children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(Fe,{children:[e.jsx(De,{children:e.jsxs(q,{className:"bg-muted/30",children:[e.jsx(K,{className:"font-semibold",children:"#"}),e.jsx(K,{className:"font-semibold",children:"Stop Name"}),e.jsx(K,{className:"font-semibold",children:"Coordinates"})]})}),e.jsx(Ee,{children:l.stops.map((x,b)=>e.jsxs(q,{className:"hover:bg-muted/20",children:[e.jsx(X,{className:"font-medium text-muted-foreground",children:b+1}),e.jsx(X,{className:"font-medium",children:x.name||"Unnamed Stop"}),e.jsx(X,{className:"font-mono text-sm",children:x.lat!=null&&x.lng!=null?`${Number(x.lat).toFixed(5)}, ${Number(x.lng).toFixed(5)}`:"No coordinates"})]},b))})]})})})]},l.id))]})}function ze(){const c=[{name:"Fortune Towne - Central Market",image:"/fortunetowne.jpg"},{name:"Homesite - Central Market",image:"/homesite.jpg"},{name:"Granada - Burgos",image:"/burgosgranada.jpg"}],[r,y]=i.useState(0),[j,p]=i.useState(!1),[u,h]=i.useState({x:0,y:0}),[l,x]=i.useState(null),b=()=>{y(d=>d===0?c.length-1:d-1),p(!1),h({x:0,y:0})},O=()=>{y(d=>d===c.length-1?0:d+1),p(!1),h({x:0,y:0})},R=d=>{j&&(d.preventDefault(),x({x:d.clientX-u.x,y:d.clientY-u.y}))},D=d=>{!j||!l||h({x:d.clientX-l.x,y:d.clientY-l.y})},T=()=>x(null),g=()=>x(null);return e.jsxs(ee,{children:[e.jsx(ye,{asChild:!0,children:e.jsx(v,{children:"Open Map Guide"})}),e.jsxs(te,{className:"max-w-5xl",children:[e.jsxs(se,{children:[e.jsx(ae,{className:"text-xl font-semibold text-center",children:"Map Route Guide"}),e.jsx(Ne,{className:"text-center",children:"View and navigate through jeepney routes with zoom and pan functionality."})]}),e.jsxs("div",{className:"relative mt-4 flex flex-col items-center overflow-hidden w-full max-h-[600px] rounded-lg",onMouseMove:D,onMouseUp:T,onMouseLeave:g,children:[e.jsx("img",{src:c[r].image,alt:c[r].name,className:`object-cover cursor-${j?"grab":"zoom-in"} transition-transform duration-300`,style:{width:"100%",maxHeight:"600px",transform:`scale(${j?2:1}) translate(${u.x/(j?2:1)}px, ${u.y/(j?2:1)}px)`,cursor:j?"grab":"zoom-in"},onClick:()=>p(d=>!d),onMouseDown:R}),e.jsx("p",{className:"mt-4 text-center text-lg font-medium",children:c[r].name}),e.jsxs("div",{className:"absolute top-1/2 w-full flex justify-between px-6 -translate-y-1/2",children:[e.jsx(v,{variant:"outline",size:"lg",onClick:b,children:"◀"}),e.jsx(v,{variant:"outline",size:"lg",onClick:O,children:"▶"})]})]})]})]})}const Oe=[{title:"Map Route",href:"/maproute"}];function tt(){const[c,r]=i.useState([]),[y,j]=i.useState(""),[p,u]=i.useState(""),[h,l]=i.useState([]),[x,b]=i.useState(!0),[O,R]=i.useState(!1),[D,T]=i.useState([]),[g,d]=i.useState(null),[w,E]=i.useState("#3388ff"),[A,U]=i.useState("main");i.useEffect(()=>{I.get("https://turnup-admin.com/sanctum/csrf-cookie",{withCredentials:!0}).then(()=>console.log("CSRF cookie set")).catch(t=>console.error(t))},[]),i.useEffect(()=>{(async()=>{try{const o=await(await fetch("/routes")).json(),P=await Promise.all(o.map(async(a,N)=>{let C=[];if(typeof a.polyline=="string")try{C=JSON.parse(a.polyline).map(_=>({lat:Number(_.lat),lng:Number(_.lng)}))}catch{C=[]}else Array.isArray(a.polyline)?C=a.polyline.map(f=>({lat:Number(f.lat),lng:Number(f.lng)})):a.polyline&&(C=[{lat:Number(a.polyline.lat),lng:Number(a.polyline.lng)}]);const L=await m(C.map(f=>({lat:Number(f.lat),lng:Number(f.lng)})));return{id:a.id??N,firstTerminal:a.first_terminal,secondTerminal:a.second_terminal,polyline:L,stops:a.stops.map(f=>({name:f.name,lat:Number(f.lat),lng:Number(f.lng)})),color:a.color??"#3388ff",type:a.type??"main"}}));r(P)}catch(s){console.error("Failed to fetch routes",s)}})()},[]);const W=async()=>{if(!y||!p){M.error("Please fill in both terminals");return}if(h.length<2){M.error("Please add at least 2 stops before saving the route");return}try{await I.get("https://turnup-admin.com/sanctum/csrf-cookie",{withCredentials:!0});const t={first_terminal:y,second_terminal:p,polyline:D[0]?.path??[],stops:h.map(a=>({name:a.name,lat:a.position.lat,lng:a.position.lng})),color:w,type:A},s=await I.post("https://turnup-admin.com/routes",t,{withCredentials:!0});let o=[];if(typeof s.data.polyline=="string")try{o=JSON.parse(s.data.polyline).map(N=>({lat:Number(N.lat),lng:Number(N.lng)}))}catch{o=[]}else Array.isArray(s.data.polyline)?o=s.data.polyline.map(a=>({lat:Number(a.lat),lng:Number(a.lng)})):s.data.polyline&&(o=[{lat:Number(s.data.polyline.lat),lng:Number(s.data.polyline.lng)}]);const P={id:s.data.id??Date.now(),firstTerminal:s.data.first_terminal,secondTerminal:s.data.second_terminal,polyline:o.map(a=>({lat:Number(a.lat),lng:Number(a.lng)})),stops:s.data.stops.map(a=>({name:a.name,lat:Number(a.lat),lng:Number(a.lng)})),color:"#3388ff",type:s.data.type??"main"};r(a=>[...a,P]),j(""),u(""),l([]),M.success("Route added successfully")}catch(t){M.error("Failed to save route."),console.log(t)}},n=async t=>{try{await I.delete(`https://turnup-admin.com/routes/${t}`,{withCredentials:!0}),r(s=>s.filter(o=>o.id!==t)),g?.id===t&&(d(null),l([]),T([])),M.success("Delete Route Successfully")}catch(s){console.error("Failed to delete route",s),M.error("Failed to delete route.")}},m=async t=>{if(t.length===0)return[];const s=t.filter(N=>!isNaN(N.lat)&&!isNaN(N.lng));if(s.length===0)return[];const P=((N,C)=>{const L=[];for(let f=0;f<N.length;f+=C)L.push(N.slice(f,f+C));return L})(s,100);let a=[];for(const N of P){const L=`https://roads.googleapis.com/v1/snapToRoads?path=${N.map(G=>`${G.lat},${G.lng}`).join("|")}&interpolate=true&key=AIzaSyAicbS4J0S5M2DRMdOsImk3FGYFb8tJCPY`,_=await(await fetch(L)).json();if(_.snappedPoints){const G=_.snappedPoints.map(Z=>({lat:Z.location.latitude,lng:Z.location.longitude}));a=[...a,...G]}}return a},S=async t=>{try{await I.patch(`https://turnup-admin.com/routes/${t}/toggle-disable`,{},{withCredentials:!0}),r(s=>s.map(o=>o.id===t?{...o,disabled:!o.disabled}:o)),M.success("Route status updated")}catch(s){console.error(s),M.error("Failed to update route status")}},k=y&&p&&h.length>=2;return e.jsxs(we,{breadcrumbs:Oe,children:[e.jsx(de,{title:"Map Route"}),e.jsxs(B,{className:"w-full max-w-4xl mx-auto m-6",children:[e.jsx(Y,{children:e.jsxs(V,{className:"flex items-center justify-between",children:["Create Route",e.jsxs(le,{variant:k?"default":"secondary",children:[h.length," stops"]})]})}),e.jsxs(Q,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"first_terminal",children:"First Terminal"}),e.jsx($,{id:"first_terminal",name:"firstTerminal",placeholder:"First Terminal",value:y,onChange:t=>j(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"second_terminal",children:"Second Terminal"}),e.jsx($,{id:"second_terminal",name:"secondTerminal",placeholder:"Second Terminal",value:p,onChange:t=>u(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"route_color",children:"Route Color"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{type:"color",id:"route_color",value:w,onChange:t=>E(t.target.value),className:"w-12 h-10 p-1 cursor-pointer"}),e.jsx($,{type:"text",value:w,onChange:t=>E(t.target.value),placeholder:"#3b82f6",className:"flex-1"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"Route Type"}),e.jsxs(ne,{value:A,onValueChange:t=>U(t),children:[e.jsx(re,{children:e.jsx(oe,{placeholder:"Select route type"})}),e.jsxs(ie,{children:[e.jsx(F,{value:"main",children:"Main Route"}),e.jsx(F,{value:"festival",children:"Festival Route"}),e.jsx(F,{value:"detour",children:"Detour Route"}),e.jsx(F,{value:"emergency",children:"Emergency Route"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-lg bg-muted/30",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${h.length<2?"bg-orange-400":"bg-green-400"}`}),e.jsx("p",{className:"text-sm text-muted-foreground",children:h.length<2?"Add at least 2 stops to save and draw routes.":"Ready to save the route"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:[e.jsx(v,{onClick:W,disabled:!y||!p||h.length<2,children:"Save Route"}),e.jsx(v,{variant:"destructive",onClick:()=>R(t=>!t),disabled:h.length===0,children:"Clear Route"}),e.jsx(ze,{})]})]})]}),g&&e.jsx(B,{className:"w-full max-w-4xl mx-auto mt-4",children:e.jsx(Y,{children:e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"text-blue-500",size:18}),"Route: ",g.firstTerminal," → ",g.secondTerminal]})})}),e.jsx("div",{className:"mt-6",children:e.jsx(Me,{stops:h,setStops:l,clearTrigger:O,polylines:D,setPolylines:T,savedPolylines:g?[{id:g.id,path:g.polyline,color:g.color??"#3388ff"}]:[],snapToRoad:m,routeColor:w})}),e.jsx("div",{className:"m-4",children:e.jsx(v,{onClick:()=>b(!x),children:x?"Hide Routes Table":"Show Routes Table"})}),x&&e.jsx(Le,{routes:c.filter(t=>t.type===A),onView:t=>{g?.id===t.id?(d(null),l([]),T([])):(l(t.stops.map(s=>({name:s.name,position:{lat:s.lat,lng:s.lng}}))),T([{id:t.id,path:t.polyline,color:t.color}]),d(t))},onDelete:n,onToggleDisable:S}),e.jsxs(B,{className:"m-10",children:[e.jsx(Y,{className:"pb-3",children:e.jsxs(V,{className:"flex items-center gap-2 text-lg",children:[e.jsx(fe,{size:18}),"Quick Start Guide"]})}),e.jsxs(Q,{className:"pt-0",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(J,{size:16,className:"text-blue-500"}),e.jsx("h3",{className:"font-medium text-base",children:"Creating a Route"})]}),e.jsxs("ol",{className:"text-sm space-y-2 list-decimal list-inside text-muted-foreground ml-6",children:[e.jsx("li",{children:"Enter start and end terminal names in the form"}),e.jsx("li",{children:"Choose a color for your route visualization"}),e.jsx("li",{children:"Click on the map to add stops along your route"}),e.jsx("li",{children:"Drag stops to adjust their positions if needed"}),e.jsx("li",{children:'Click "Save Route" when you have at least 2 stops'})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Se,{size:16,className:"text-green-500"}),e.jsx("h3",{className:"font-medium text-base",children:"Managing Routes"})]}),e.jsxs("ul",{className:"text-sm space-y-2 list-disc list-inside text-muted-foreground ml-6",children:[e.jsx("li",{children:'Use "Show Routes" to view all your saved routes'}),e.jsx("li",{children:'Click "View" to display a specific route on the map'}),e.jsx("li",{children:'Use "Delete" to remove routes you no longer need'}),e.jsx("li",{children:"Routes are displayed with your chosen color on the map"})]})]})]}),e.jsxs("div",{className:"mt-6 pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ce,{size:16,className:"text-purple-500"}),e.jsx("h3",{className:"font-medium text-base",children:"Tips & Best Practices"})]}),e.jsxs("ul",{className:"text-sm space-y-1 list-disc list-inside text-muted-foreground ml-6 grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsx("li",{children:"Add descriptive terminal names for easy identification"}),e.jsx("li",{children:"Use different colors for each route to distinguish them"}),e.jsx("li",{children:"Place stops in logical order along your intended path"}),e.jsx("li",{children:"Test your route by viewing it before finalizing"})]})]})]})]})]})}export{tt as default};
