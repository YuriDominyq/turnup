import{u as ce,r as o,j as e,a as P,H as de}from"./app-CRUS1tHO.js";import{u as me,G as ue,d as he,l as pe,M as xe,P as ge,I as fe}from"./esm-CCcI8FS_.js";import{D as ee,a as te,b as se,c as ae,d as je,e as ye,f as be}from"./dialog-C_FAMsjq.js";import{I as _}from"./input-CxmGuEKg.js";import{B as S,c as A}from"./app-logo-icon-D2PYe5qs.js";import{C as B,a as V,b as Y,c as X}from"./card-2SG5wWo4.js";import{B as le}from"./badge-FyWnHuOi.js";import{S as ne,a as re,b as oe,c as ie,d as D}from"./select-aFCGnanA.js";import{M as Q}from"./map-pin-DGyHzBvO.js";import{E as Ne,T as ve}from"./trash-2-DM0PPEH3.js";import{L as H}from"./label-CSEwGiKe.js";import{a as we,S as Se,y as F}from"./app-layout-B9mLBe3M.js";import{R as Ce}from"./route-B3XXljSn.js";/* empty css            */import"./createLucideIcon-LjFBWVOB.js";import"./index-D1a_31i-.js";import"./index-CYZ-zaC2.js";import"./index-B6n4XYw9.js";import"./users-B4NuoJfa.js";const Re={width:"100%",height:"450px"},Te={lat:10.6676,lng:122.9456},ke=["places","drawing"];function Me({stops:i,setStops:n,clearTrigger:b,polylines:j,setPolylines:y,savedPolylines:m,routeColor:x}){const{isLoaded:u}=me({googleMapsApiKey:"AIzaSyAicbS4J0S5M2DRMdOsImk3FGYFb8tJCPY",libraries:ke}),{appearance:p}=ce(),[c,N]=o.useState(!1),[w,L]=o.useState(null),[k,g]=o.useState(!1),[d,C]=o.useState(null),O=o.useRef([]);o.useEffect(()=>{const l=window.matchMedia("(prefers-color-scheme: dark)").matches;N(p==="dark"||p==="system"&&l)},[p]),o.useEffect(()=>{!m||m.length===0||y(l=>l.length===m.length&&l.every((R,M)=>{const t=m[M];return R.id===t.id&&R.path.length===t.path.length&&R.path.every((a,r)=>a.lat===t.path[r].lat&&a.lng===t.path[r].lng)})?l:m)},[m]),o.useEffect(()=>{b&&(y([]),n([]))},[b,n]),o.useEffect(()=>{if(!w||!m||m.length===0)return;O.current.forEach(h=>h.setMap(null)),O.current=[];const l=new google.maps.LatLngBounds;m.forEach(h=>{const R=h.path.map(t=>{const a=typeof t.lat=="string"?parseFloat(t.lat):t.lat,r=typeof t.lng=="string"?parseFloat(t.lng):t.lng;return l.extend({lat:a,lng:r}),{lat:a,lng:r}}),M=new google.maps.Polyline({path:R,strokeColor:h.color,strokeWeight:3,editable:!1,map:w});O.current.push(M)}),l.isEmpty()||w.fitBounds(l)},[w,m]);const I=l=>{if(!l.latLng)return;const h={lat:l.latLng.lat(),lng:l.latLng.lng()};C({position:h,name:""}),g(!0)},J=()=>{d&&d.name.trim()&&(n([...i,{name:d.name,position:d.position}]),g(!1),C(null))},U=l=>{L(l);const h=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.POLYLINE,drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT,drawingModes:[google.maps.drawing.OverlayType.POLYLINE,google.maps.drawing.OverlayType.MARKER]},polylineOptions:{strokeColor:"#3b82f6",strokeWeight:3,editable:!0,geodesic:!0}});h.setMap(l),google.maps.event.addListener(h,"overlaycomplete",async R=>{if(R.type===google.maps.drawing.OverlayType.POLYLINE){const M=R.overlay,t=M.getPath().getArray().map(r=>({lat:r.lat(),lng:r.lng()})),a={id:Date.now(),path:t,color:x};y(r=>[...r,a]),M.setMap(null)}})};return e.jsxs("div",{className:"flex justify-center py-6",children:[e.jsxs("div",{className:"w-full max-w-6xl rounded-2xl shadow-xl overflow-hidden border border-gray-200 dark:border-gray-700",children:[!u&&e.jsxs("div",{className:"relative h-[450px] flex items-center justify-center bg-gray-100 dark:bg-gray-800 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-blue-500"}),e.jsx("span",{className:"absolute mt-16 text-gray-700 dark:text-gray-200",children:"Loading map..."})]}),u&&e.jsxs(ue,{mapContainerStyle:Re,center:Te,zoom:12,onClick:I,onLoad:U,options:{styles:c?he:pe,disableDefaultUI:!0,zoomControl:!0,gestureHandling:"greedy"},children:[i.map((l,h)=>e.jsx(xe,{position:l.position,title:l.name,label:{text:`${h+1}`,color:c?"#000000":"#FFFFFF",fontSize:"12px",fontWeight:"bold"},icon:{path:google.maps.SymbolPath.CIRCLE,scale:12,fillColor:c?"#FFD700":"#2196F3",fillOpacity:1,strokeWeight:2,strokeColor:c?"#fff":"#000"}},h)),j.map((l,h)=>e.jsx(ge,{path:l.path,options:{strokeColor:l.color,strokeOpacity:1,strokeWeight:3,editable:!0,geodesic:!0}},h))]})]}),e.jsx(ee,{open:k,onOpenChange:l=>{g(l),l||C(null)},children:e.jsxs(te,{children:[e.jsx(se,{children:e.jsx(ae,{children:"Add Stop"})}),e.jsx(_,{placeholder:"Enter stop name",value:d?.name||"",onChange:l=>C(h=>h?{...h,name:l.target.value}:null)}),e.jsxs(je,{children:[e.jsx(S,{variant:"outline",onClick:()=>{g(!1),C(null)},children:"Cancel"}),e.jsx(S,{onClick:J,disabled:!d?.name.trim(),children:"Save"})]})]})})]})}function Fe({className:i,...n}){return e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{className:A("w-full caption-bottom text-sm",i),...n})})}function De({className:i,...n}){return e.jsx("thead",{className:A("[&_tr]:border-b",i),...n})}function Ee({className:i,...n}){return e.jsx("tbody",{className:A("[&_tr:last-child]:border-0",i),...n})}function q({className:i,...n}){return e.jsx("tr",{className:A("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",i),...n})}function W({className:i,...n}){return e.jsx("th",{className:A("h-10 px-2 text-left align-middle font-medium text-muted-foreground",i),...n})}function K({className:i,...n}){return e.jsx("td",{className:A("p-2 align-middle",i),...n})}function Le({routes:i,onView:n,onDelete:b,onToggleDisable:j}){const y=i.reduce((u,p)=>{const c=`${p.firstTerminal}→${p.secondTerminal}`;return u[c]||(u[c]=[]),u[c].push(p),u},{}),[m,x]=o.useState("main");return i.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Q,{className:"mx-auto h-12 w-12 text-muted-foreground"}),e.jsx("h3",{className:"mt-2 text-sm font-semibold text-foreground",children:"No Routes"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Get started by creating your first route."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end max-w-5xl mx-auto mb-4",children:e.jsxs(ne,{value:m,onValueChange:u=>x(u),children:[e.jsx(re,{className:"w-40",children:e.jsx(oe,{placeholder:"Route Type"})}),e.jsxs(ie,{children:[e.jsx(D,{value:"main",children:"Main Route"}),e.jsx(D,{value:"festival",children:"Festival Route"}),e.jsx(D,{value:"detour",children:"Detour Route"}),e.jsx(D,{value:"emergency",children:"Emergency Route"})]})]})}),Object.entries(y).map(([u,p])=>{if(p.length===0)return null;const c=p.find(N=>N.type===m);return c?e.jsxs(B,{className:"shadow-md max-w-5xl mx-auto",style:{borderLeft:`6px solid ${c.color}`},children:[e.jsxs(V,{className:"pb-4 flex flex-col md:flex-row items-start md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs(Y,{className:"flex items-center gap-2 text-lg",children:[e.jsx("span",{className:"truncate",children:c.firstTerminal}),e.jsx("span",{className:"text-muted-foreground",children:"→"}),e.jsx("span",{className:"truncate",children:c.secondTerminal})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs(le,{variant:"secondary",className:"text-xs",children:[c.stops.length," stops"]}),e.jsx("div",{className:"w-4 h-4 rounded-full border border-border",style:{backgroundColor:c.color}})]})]}),e.jsxs("div",{className:"flex gap-2",children:[n&&e.jsxs(S,{size:"sm",variant:"outline",onClick:()=>n(c),children:[e.jsx(Ne,{className:"w-4 h-4 mr-1"})," View"]}),j&&e.jsx(S,{size:"sm",variant:c.disabled?"outline":"secondary",onClick:()=>j(c.id),children:c.disabled?"Enable":"Disable"}),e.jsxs(S,{size:"sm",variant:"destructive",onClick:()=>b(c.id),children:[e.jsx(ve,{className:"w-4 h-4 mr-1"})," Delete"]})]})]}),e.jsx(X,{className:"pt-0",children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(Fe,{children:[e.jsx(De,{children:e.jsxs(q,{className:"bg-muted/30",children:[e.jsx(W,{children:"#"}),e.jsx(W,{children:"Stop Name"}),e.jsx(W,{children:"Coordinates"})]})}),e.jsx(Ee,{children:c.stops.map((N,w)=>e.jsxs(q,{className:"hover:bg-muted/20",children:[e.jsx(K,{className:"font-medium text-muted-foreground",children:w+1}),e.jsx(K,{className:"font-medium",children:N.name||"Unnamed Stop"}),e.jsx(K,{className:"font-mono text-sm",children:N.lat&&N.lng?`${N.lat.toFixed(5)}, ${N.lng.toFixed(5)}`:"No coordinates"})]},w))})]})})})]},u):null})]})}function Oe(){const i=[{name:"Fortune Towne - Central Market",image:"/fortunetowne.jpg"},{name:"Homesite - Central Market",image:"/homesite.jpg"},{name:"Granada - Burgos",image:"/burgosgranada.jpg"}],[n,b]=o.useState(0),[j,y]=o.useState(!1),[m,x]=o.useState({x:0,y:0}),[u,p]=o.useState(null),c=()=>{b(d=>d===0?i.length-1:d-1),y(!1),x({x:0,y:0})},N=()=>{b(d=>d===i.length-1?0:d+1),y(!1),x({x:0,y:0})},w=d=>{j&&(d.preventDefault(),p({x:d.clientX-m.x,y:d.clientY-m.y}))},L=d=>{!j||!u||x({x:d.clientX-u.x,y:d.clientY-u.y})},k=()=>p(null),g=()=>p(null);return e.jsxs(ee,{children:[e.jsx(ye,{asChild:!0,children:e.jsx(S,{children:"Open Map Guide"})}),e.jsxs(te,{className:"max-w-5xl",children:[e.jsxs(se,{children:[e.jsx(ae,{className:"text-xl font-semibold text-center",children:"Map Route Guide"}),e.jsx(be,{className:"text-center",children:"View and navigate through jeepney routes with zoom and pan functionality."})]}),e.jsxs("div",{className:"relative mt-4 flex flex-col items-center overflow-hidden w-full max-h-[600px] rounded-lg",onMouseMove:L,onMouseUp:k,onMouseLeave:g,children:[e.jsx("img",{src:i[n].image,alt:i[n].name,className:`object-cover cursor-${j?"grab":"zoom-in"} transition-transform duration-300`,style:{width:"100%",maxHeight:"600px",transform:`scale(${j?2:1}) translate(${m.x/(j?2:1)}px, ${m.y/(j?2:1)}px)`,cursor:j?"grab":"zoom-in"},onClick:()=>y(d=>!d),onMouseDown:w}),e.jsx("p",{className:"mt-4 text-center text-lg font-medium",children:i[n].name}),e.jsxs("div",{className:"absolute top-1/2 w-full flex justify-between px-6 -translate-y-1/2",children:[e.jsx(S,{variant:"outline",size:"lg",onClick:c,children:"◀"}),e.jsx(S,{variant:"outline",size:"lg",onClick:N,children:"▶"})]})]})]})]})}const ze=[{title:"Map Route",href:"/maproute"}];function tt(){const[i,n]=o.useState([]),[b,j]=o.useState(""),[y,m]=o.useState(""),[x,u]=o.useState([]),[p,c]=o.useState(!0),[N,w]=o.useState(!1),[L,k]=o.useState([]),[g,d]=o.useState(null),[C,O]=o.useState("#3388ff"),[I,J]=o.useState("main");o.useEffect(()=>{P.get("https://turnup-admin.com/sanctum/csrf-cookie",{withCredentials:!0}).then(()=>console.log("CSRF cookie set")).catch(t=>console.error(t))},[]),o.useEffect(()=>{(async()=>{try{const r=await(await fetch("/routes")).json(),E=await Promise.all(r.map(async(s,v)=>{let T=[];if(typeof s.polyline=="string")try{T=JSON.parse(s.polyline).map($=>({lat:Number($.lat),lng:Number($.lng)}))}catch{T=[]}else Array.isArray(s.polyline)?T=s.polyline.map(f=>({lat:Number(f.lat),lng:Number(f.lng)})):s.polyline&&(T=[{lat:Number(s.polyline.lat),lng:Number(s.polyline.lng)}]);const z=await h(T.map(f=>({lat:Number(f.lat),lng:Number(f.lng)})));return{id:s.id??v,firstTerminal:s.first_terminal,secondTerminal:s.second_terminal,polyline:z,stops:s.stops.map(f=>({name:f.name,lat:Number(f.lat),lng:Number(f.lng)})),color:s.color??"#3388ff",type:s.type??"main"}}));n(E)}catch(a){console.error("Failed to fetch routes",a)}})()},[]);const U=async()=>{if(!b||!y){F.error("Please fill in both terminals");return}if(x.length<2){F.error("Please add at least 2 stops before saving the route");return}try{await P.get("https://turnup-admin.com/sanctum/csrf-cookie",{withCredentials:!0});const t={first_terminal:b,second_terminal:y,polyline:L[0]?.path??[],stops:x.map(s=>({name:s.name,lat:s.position.lat,lng:s.position.lng})),color:C,type:I},a=await P.post("https://turnup-admin.com/routes",t,{withCredentials:!0});let r=[];if(typeof a.data.polyline=="string")try{r=JSON.parse(a.data.polyline).map(v=>({lat:Number(v.lat),lng:Number(v.lng)}))}catch{r=[]}else Array.isArray(a.data.polyline)?r=a.data.polyline.map(s=>({lat:Number(s.lat),lng:Number(s.lng)})):a.data.polyline&&(r=[{lat:Number(a.data.polyline.lat),lng:Number(a.data.polyline.lng)}]);const E={id:a.data.id??Date.now(),firstTerminal:a.data.first_terminal,secondTerminal:a.data.second_terminal,polyline:r.map(s=>({lat:Number(s.lat),lng:Number(s.lng)})),stops:a.data.stops.map(s=>({name:s.name,lat:Number(s.lat),lng:Number(s.lng)})),color:"#3388ff",type:a.data.type??"main"};n(s=>[...s,E]),j(""),m(""),u([]),F.success("Route added successfully")}catch(t){F.error("Failed to save route."),console.log(t)}},l=async t=>{try{await P.delete(`https://turnup-admin.com/routes/${t}`,{withCredentials:!0}),n(a=>a.filter(r=>r.id!==t)),g?.id===t&&(d(null),u([]),k([])),F.success("Delete Route Successfully")}catch(a){console.error("Failed to delete route",a),F.error("Failed to delete route.")}},h=async t=>{if(t.length===0)return[];const a=t.filter(v=>!isNaN(v.lat)&&!isNaN(v.lng));if(a.length===0)return[];const E=((v,T)=>{const z=[];for(let f=0;f<v.length;f+=T)z.push(v.slice(f,f+T));return z})(a,100);let s=[];for(const v of E){const z=`https://roads.googleapis.com/v1/snapToRoads?path=${v.map(G=>`${G.lat},${G.lng}`).join("|")}&interpolate=true&key=AIzaSyAicbS4J0S5M2DRMdOsImk3FGYFb8tJCPY`,$=await(await fetch(z)).json();if($.snappedPoints){const G=$.snappedPoints.map(Z=>({lat:Z.location.latitude,lng:Z.location.longitude}));s=[...s,...G]}}return s},R=async t=>{try{await P.patch(`https://turnup-admin.com/routes/${t}/toggle-disable`,{},{withCredentials:!0}),n(a=>{const r=a.find(s=>s.id===t);if(!r)return a;const E=!r.disabled;return a.map(s=>s.firstTerminal===r.firstTerminal&&s.secondTerminal===r.secondTerminal?{...s,disabled:s.id===t?E:!0}:s)}),F.success("Route status updated")}catch(a){console.error(a),F.error("Failed to update route status")}},M=b&&y&&x.length>=2;return e.jsxs(we,{breadcrumbs:ze,children:[e.jsx(de,{title:"Map Route"}),e.jsxs(B,{className:"w-full max-w-4xl mx-auto m-6",children:[e.jsx(V,{children:e.jsxs(Y,{className:"flex items-center justify-between",children:["Create Route",e.jsxs(le,{variant:M?"default":"secondary",children:[x.length," stops"]})]})}),e.jsxs(X,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"first_terminal",children:"First Terminal"}),e.jsx(_,{id:"first_terminal",name:"firstTerminal",placeholder:"First Terminal",value:b,onChange:t=>j(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"second_terminal",children:"Second Terminal"}),e.jsx(_,{id:"second_terminal",name:"secondTerminal",placeholder:"Second Terminal",value:y,onChange:t=>m(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"route_color",children:"Route Color"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{type:"color",id:"route_color",value:C,onChange:t=>O(t.target.value),className:"w-12 h-10 p-1 cursor-pointer"}),e.jsx(_,{type:"text",value:C,onChange:t=>O(t.target.value),placeholder:"#3b82f6",className:"flex-1"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"Route Type"}),e.jsxs(ne,{value:I,onValueChange:t=>J(t),children:[e.jsx(re,{children:e.jsx(oe,{placeholder:"Select route type"})}),e.jsxs(ie,{children:[e.jsx(D,{value:"main",children:"Main Route"}),e.jsx(D,{value:"festival",children:"Festival Route"}),e.jsx(D,{value:"detour",children:"Detour Route"}),e.jsx(D,{value:"emergency",children:"Emergency Route"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-lg bg-muted/30",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${x.length<2?"bg-orange-400":"bg-green-400"}`}),e.jsx("p",{className:"text-sm text-muted-foreground",children:x.length<2?"Add at least 2 stops to save and draw routes.":"Ready to save the route"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:[e.jsx(S,{onClick:U,disabled:!b||!y||x.length<2,children:"Save Route"}),e.jsx(S,{variant:"destructive",onClick:()=>w(t=>!t),disabled:x.length===0,children:"Clear Route"}),e.jsx(Oe,{})]})]})]}),g&&e.jsx(B,{className:"w-full max-w-4xl mx-auto mt-4",children:e.jsx(V,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"text-blue-500",size:18}),"Route: ",g.firstTerminal," → ",g.secondTerminal]})})}),e.jsx("div",{className:"mt-6",children:e.jsx(Me,{stops:x,setStops:u,clearTrigger:N,polylines:L,setPolylines:k,savedPolylines:g?[{id:g.id,path:g.polyline,color:g.color??"#3388ff"}]:[],snapToRoad:h,routeColor:C})}),e.jsx("div",{className:"m-4",children:e.jsx(S,{onClick:()=>c(!p),children:p?"Hide Routes Table":"Show Routes Table"})}),p&&e.jsx(Le,{routes:i,onView:t=>{g?.id===t.id?(d(null),u([]),k([])):(u(t.stops.map(a=>({name:a.name,position:{lat:a.lat,lng:a.lng}}))),k([{id:t.id,path:t.polyline,color:t.color}]),d(t))},onDelete:l,onToggleDisable:R}),e.jsxs(B,{className:"m-10",children:[e.jsx(V,{className:"pb-3",children:e.jsxs(Y,{className:"flex items-center gap-2 text-lg",children:[e.jsx(fe,{size:18}),"Quick Start Guide"]})}),e.jsxs(X,{className:"pt-0",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Q,{size:16,className:"text-blue-500"}),e.jsx("h3",{className:"font-medium text-base",children:"Creating a Route"})]}),e.jsxs("ol",{className:"text-sm space-y-2 list-decimal list-inside text-muted-foreground ml-6",children:[e.jsx("li",{children:"Enter start and end terminal names in the form"}),e.jsx("li",{children:"Choose a color for your route visualization"}),e.jsx("li",{children:"Click on the map to add stops along your route"}),e.jsx("li",{children:"Drag stops to adjust their positions if needed"}),e.jsx("li",{children:'Click "Save Route" when you have at least 2 stops'})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Se,{size:16,className:"text-green-500"}),e.jsx("h3",{className:"font-medium text-base",children:"Managing Routes"})]}),e.jsxs("ul",{className:"text-sm space-y-2 list-disc list-inside text-muted-foreground ml-6",children:[e.jsx("li",{children:'Use "Show Routes" to view all your saved routes'}),e.jsx("li",{children:'Click "View" to display a specific route on the map'}),e.jsx("li",{children:'Use "Delete" to remove routes you no longer need'}),e.jsx("li",{children:"Routes are displayed with your chosen color on the map"})]})]})]}),e.jsxs("div",{className:"mt-6 pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ce,{size:16,className:"text-purple-500"}),e.jsx("h3",{className:"font-medium text-base",children:"Tips & Best Practices"})]}),e.jsxs("ul",{className:"text-sm space-y-1 list-disc list-inside text-muted-foreground ml-6 grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsx("li",{children:"Add descriptive terminal names for easy identification"}),e.jsx("li",{children:"Use different colors for each route to distinguish them"}),e.jsx("li",{children:"Place stops in logical order along your intended path"}),e.jsx("li",{children:"Test your route by viewing it before finalizing"})]})]})]})]})]})}export{tt as default};
