import{u as ne,r as c,j as e,a as P,H as re}from"./app-CPanPMYi.js";import{u as oe,G as ie,d as ce,l as de,M as me,P as ue,I as he}from"./esm-BLb-ti2Y.js";import{D as ee,a as te,b as se,c as ae,d as pe,e as ge,f as xe}from"./dialog-yzOt8dX9.js";import{I as $}from"./input-C-rgsl6h.js";import{B as C,c as O}from"./app-logo-icon-CKhzftPY.js";import{C as B,a as Y,b as V,c as X}from"./card-CzfQ9Es1.js";import{B as le}from"./badge-D_GAnO53.js";import{T as fe,a as je,b as ye,c as be}from"./tabs-DTzAPsAL.js";import{M as Q}from"./map-pin-DdB_FKXf.js";import{E as Ne,T as we}from"./trash-2-BncqExmv.js";import{L as G}from"./label-CLUzaeCQ.js";import{a as ve,S as Ce,y as F}from"./app-layout-7xZ8JjP9.js";import{S as Se,a as Te,b as Re,c as ke,d as H}from"./select-Cdg7LJ3z.js";import{R as Me}from"./route-6obm-S51.js";/* empty css            */import"./createLucideIcon-C4YpXrYc.js";import"./index-DDlTmRWP.js";import"./index-CajZIZFr.js";import"./users-D_lTs5ub.js";import"./index-D31jzGSc.js";const Fe={width:"100%",height:"450px"},De={lat:10.6676,lng:122.9456},Le=["places","drawing"];function Ee({stops:o,setStops:n,clearTrigger:b,polylines:j,setPolylines:y,savedPolylines:p,routeColor:m}){const{isLoaded:u}=oe({googleMapsApiKey:"AIzaSyAicbS4J0S5M2DRMdOsImk3FGYFb8tJCPY",libraries:Le}),{appearance:g}=ne(),[d,N]=c.useState(!1),[v,L]=c.useState(null),[k,x]=c.useState(!1),[i,S]=c.useState(null),E=c.useRef([]);c.useEffect(()=>{const l=window.matchMedia("(prefers-color-scheme: dark)").matches;N(g==="dark"||g==="system"&&l)},[g]),c.useEffect(()=>{!p||p.length===0||y(l=>l.length===p.length&&l.every((T,M)=>{const t=p[M];return T.id===t.id&&T.path.length===t.path.length&&T.path.every((a,r)=>a.lat===t.path[r].lat&&a.lng===t.path[r].lng)})?l:p)},[p]),c.useEffect(()=>{b&&(y([]),n([]))},[b,n]),c.useEffect(()=>{if(!v||!p||p.length===0)return;E.current.forEach(h=>h.setMap(null)),E.current=[];const l=new google.maps.LatLngBounds;p.forEach(h=>{const T=h.path.map(t=>{const a=typeof t.lat=="string"?parseFloat(t.lat):t.lat,r=typeof t.lng=="string"?parseFloat(t.lng):t.lng;return l.extend({lat:a,lng:r}),{lat:a,lng:r}}),M=new google.maps.Polyline({path:T,strokeColor:h.color,strokeWeight:3,editable:!1,map:v});E.current.push(M)}),l.isEmpty()||v.fitBounds(l)},[v,p]);const _=l=>{if(!l.latLng)return;const h={lat:l.latLng.lat(),lng:l.latLng.lng()};S({position:h,name:""}),x(!0)},J=()=>{i&&i.name.trim()&&(n([...o,{name:i.name,position:i.position}]),x(!1),S(null))},U=l=>{L(l);const h=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.POLYLINE,drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT,drawingModes:[google.maps.drawing.OverlayType.POLYLINE,google.maps.drawing.OverlayType.MARKER]},polylineOptions:{strokeColor:"#3b82f6",strokeWeight:3,editable:!0,geodesic:!0}});h.setMap(l),google.maps.event.addListener(h,"overlaycomplete",async T=>{if(T.type===google.maps.drawing.OverlayType.POLYLINE){const M=T.overlay,t=M.getPath().getArray().map(r=>({lat:r.lat(),lng:r.lng()})),a={id:Date.now(),path:t,color:m};y(r=>[...r,a]),M.setMap(null)}})};return e.jsxs("div",{className:"flex justify-center py-6",children:[e.jsxs("div",{className:"w-full max-w-6xl rounded-2xl shadow-xl overflow-hidden border border-gray-200 dark:border-gray-700",children:[!u&&e.jsxs("div",{className:"relative h-[450px] flex items-center justify-center bg-gray-100 dark:bg-gray-800 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-blue-500"}),e.jsx("span",{className:"absolute mt-16 text-gray-700 dark:text-gray-200",children:"Loading map..."})]}),u&&e.jsxs(ie,{mapContainerStyle:Fe,center:De,zoom:12,onClick:_,onLoad:U,options:{styles:d?ce:de,disableDefaultUI:!0,zoomControl:!0,gestureHandling:"greedy"},children:[o.map((l,h)=>e.jsx(me,{position:l.position,title:l.name,label:{text:`${h+1}`,color:d?"#000000":"#FFFFFF",fontSize:"12px",fontWeight:"bold"},icon:{path:google.maps.SymbolPath.CIRCLE,scale:12,fillColor:d?"#FFD700":"#2196F3",fillOpacity:1,strokeWeight:2,strokeColor:d?"#fff":"#000"}},h)),j.map((l,h)=>e.jsx(ue,{path:l.path,options:{strokeColor:l.color,strokeOpacity:1,strokeWeight:3,editable:!0,geodesic:!0}},h))]})]}),e.jsx(ee,{open:k,onOpenChange:l=>{x(l),l||S(null)},children:e.jsxs(te,{children:[e.jsx(se,{children:e.jsx(ae,{children:"Add Stop"})}),e.jsx($,{placeholder:"Enter stop name",value:i?.name||"",onChange:l=>S(h=>h?{...h,name:l.target.value}:null)}),e.jsxs(pe,{children:[e.jsx(C,{variant:"outline",onClick:()=>{x(!1),S(null)},children:"Cancel"}),e.jsx(C,{onClick:J,disabled:!i?.name.trim(),children:"Save"})]})]})})]})}function ze({className:o,...n}){return e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{className:O("w-full caption-bottom text-sm",o),...n})})}function Oe({className:o,...n}){return e.jsx("thead",{className:O("[&_tr]:border-b",o),...n})}function Ae({className:o,...n}){return e.jsx("tbody",{className:O("[&_tr:last-child]:border-0",o),...n})}function q({className:o,...n}){return e.jsx("tr",{className:O("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",o),...n})}function W({className:o,...n}){return e.jsx("th",{className:O("h-10 px-2 text-left align-middle font-medium text-muted-foreground",o),...n})}function K({className:o,...n}){return e.jsx("td",{className:O("p-2 align-middle",o),...n})}function Pe({routes:o,onView:n,onDelete:b,onToggleDisable:j}){if(o.length===0)return e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Q,{className:"mx-auto h-12 w-12 text-muted-foreground"}),e.jsx("h3",{className:"mt-2 text-sm font-semibold text-foreground",children:"No Routes"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Get started by creating your first route."})]});const y=o.reduce((m,u)=>{const g=`${u.firstTerminal}→${u.secondTerminal}`;return m[g]||(m[g]=[]),m[g].push(u),m},{}),p=["main","festival","detour","emergency"];return e.jsx("div",{className:"space-y-6",children:Object.entries(y).map(([m,u])=>{if(u.length===0)return null;const g=u[0].type;return e.jsxs(B,{className:"shadow-md max-w-5xl mx-auto",style:{borderLeft:`6px solid ${u[0].color}`},children:[e.jsx(Y,{children:e.jsx(V,{className:"text-lg",children:m})}),e.jsx(X,{children:e.jsxs(fe,{defaultValue:g,className:"w-full",children:[e.jsx(je,{className:"grid grid-cols-4 w-full mb-4",children:p.map(d=>u.some(N=>N.type===d)&&e.jsx(ye,{value:d,className:"capitalize",children:d},d))}),u.map(d=>e.jsxs(be,{value:d.type,children:[e.jsxs("div",{className:"flex justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(le,{variant:"secondary",children:[d.stops.length," stops"]}),e.jsx("div",{className:"w-4 h-4 rounded-full border",style:{backgroundColor:d.color}})]}),e.jsxs("div",{className:"flex gap-2",children:[n&&e.jsxs(C,{size:"sm",variant:"outline",onClick:()=>n(d),children:[e.jsx(Ne,{className:"w-4 h-4 mr-1"})," View"]}),j&&e.jsx(C,{size:"sm",variant:d.disabled?"outline":"secondary",onClick:()=>j(d.id),children:d.disabled?"Enable":"Disable"}),e.jsxs(C,{size:"sm",variant:"destructive",onClick:()=>b(d.id),children:[e.jsx(we,{className:"w-4 h-4 mr-1"})," Delete"]})]})]}),e.jsx("div",{className:"rounded-md border max-h-64 overflow-y-auto",children:e.jsxs(ze,{children:[e.jsx(Oe,{className:"sticky top-0 z-10 bg-background",children:e.jsxs(q,{className:"bg-muted/30",children:[e.jsx(W,{children:"#"}),e.jsx(W,{children:"Stop Name"}),e.jsx(W,{children:"Coordinates"})]})}),e.jsx(Ae,{children:d.stops.map((N,v)=>e.jsxs(q,{className:"hover:bg-muted/20",children:[e.jsx(K,{className:"text-muted-foreground",children:v+1}),e.jsx(K,{children:N.name||"Unnamed Stop"}),e.jsx(K,{className:"font-mono text-sm",children:N.lat&&N.lng?`${N.lat.toFixed(5)}, ${N.lng.toFixed(5)}`:"No coordinates"})]},v))})]})})]},d.id))]})})]},m)})})}function $e(){const o=[{name:"Fortune Towne - Central Market",image:"/fortunetowne.jpg"},{name:"Homesite - Central Market",image:"/homesite.jpg"},{name:"Granada - Burgos",image:"/burgosgranada.jpg"}],[n,b]=c.useState(0),[j,y]=c.useState(!1),[p,m]=c.useState({x:0,y:0}),[u,g]=c.useState(null),d=()=>{b(i=>i===0?o.length-1:i-1),y(!1),m({x:0,y:0})},N=()=>{b(i=>i===o.length-1?0:i+1),y(!1),m({x:0,y:0})},v=i=>{j&&(i.preventDefault(),g({x:i.clientX-p.x,y:i.clientY-p.y}))},L=i=>{!j||!u||m({x:i.clientX-u.x,y:i.clientY-u.y})},k=()=>g(null),x=()=>g(null);return e.jsxs(ee,{children:[e.jsx(ge,{asChild:!0,children:e.jsx(C,{children:"Open Map Guide"})}),e.jsxs(te,{className:"max-w-5xl",children:[e.jsxs(se,{children:[e.jsx(ae,{className:"text-xl font-semibold text-center",children:"Map Route Guide"}),e.jsx(xe,{className:"text-center",children:"View and navigate through jeepney routes with zoom and pan functionality."})]}),e.jsxs("div",{className:"relative mt-4 flex flex-col items-center overflow-hidden w-full max-h-[600px] rounded-lg",onMouseMove:L,onMouseUp:k,onMouseLeave:x,children:[e.jsx("img",{src:o[n].image,alt:o[n].name,className:`object-cover cursor-${j?"grab":"zoom-in"} transition-transform duration-300`,style:{width:"100%",maxHeight:"600px",transform:`scale(${j?2:1}) translate(${p.x/(j?2:1)}px, ${p.y/(j?2:1)}px)`,cursor:j?"grab":"zoom-in"},onClick:()=>y(i=>!i),onMouseDown:v}),e.jsx("p",{className:"mt-4 text-center text-lg font-medium",children:o[n].name}),e.jsxs("div",{className:"absolute top-1/2 w-full flex justify-between px-6 -translate-y-1/2",children:[e.jsx(C,{variant:"outline",size:"lg",onClick:d,children:"◀"}),e.jsx(C,{variant:"outline",size:"lg",onClick:N,children:"▶"})]})]})]})]})}const _e=[{title:"Map Route",href:"/maproute"}];function rt(){const[o,n]=c.useState([]),[b,j]=c.useState(""),[y,p]=c.useState(""),[m,u]=c.useState([]),[g,d]=c.useState(!0),[N,v]=c.useState(!1),[L,k]=c.useState([]),[x,i]=c.useState(null),[S,E]=c.useState("#3388ff"),[_,J]=c.useState("main");c.useEffect(()=>{P.get("https://turnup-admin.com/sanctum/csrf-cookie",{withCredentials:!0}).then(()=>console.log("CSRF cookie set")).catch(t=>console.error(t))},[]),c.useEffect(()=>{(async()=>{try{const r=await(await fetch("/routes")).json(),D=await Promise.all(r.map(async(s,w)=>{let R=[];if(typeof s.polyline=="string")try{R=JSON.parse(s.polyline).map(A=>({lat:Number(A.lat),lng:Number(A.lng)}))}catch{R=[]}else Array.isArray(s.polyline)?R=s.polyline.map(f=>({lat:Number(f.lat),lng:Number(f.lng)})):s.polyline&&(R=[{lat:Number(s.polyline.lat),lng:Number(s.polyline.lng)}]);const z=await h(R.map(f=>({lat:Number(f.lat),lng:Number(f.lng)})));return{id:s.id??w,firstTerminal:s.first_terminal,secondTerminal:s.second_terminal,polyline:z,stops:s.stops.map(f=>({name:f.name,lat:Number(f.lat),lng:Number(f.lng)})),color:s.color??"#3388ff",type:s.type??"main"}}));n(D)}catch(a){console.error("Failed to fetch routes",a)}})()},[]);const U=async()=>{if(!b||!y){F.error("Please fill in both terminals");return}if(m.length<2){F.error("Please add at least 2 stops before saving the route");return}try{await P.get("https://turnup-admin.com/sanctum/csrf-cookie",{withCredentials:!0});const t={first_terminal:b,second_terminal:y,polyline:L[0]?.path??[],stops:m.map(s=>({name:s.name,lat:s.position.lat,lng:s.position.lng})),color:S,type:_},a=await P.post("https://turnup-admin.com/routes",t,{withCredentials:!0});let r=[];if(typeof a.data.polyline=="string")try{r=JSON.parse(a.data.polyline).map(w=>({lat:Number(w.lat),lng:Number(w.lng)}))}catch{r=[]}else Array.isArray(a.data.polyline)?r=a.data.polyline.map(s=>({lat:Number(s.lat),lng:Number(s.lng)})):a.data.polyline&&(r=[{lat:Number(a.data.polyline.lat),lng:Number(a.data.polyline.lng)}]);const D={id:a.data.id??Date.now(),firstTerminal:a.data.first_terminal,secondTerminal:a.data.second_terminal,polyline:r.map(s=>({lat:Number(s.lat),lng:Number(s.lng)})),stops:a.data.stops.map(s=>({name:s.name,lat:Number(s.lat),lng:Number(s.lng)})),color:"#3388ff",type:a.data.type??"main"};n(s=>[...s,D]),j(""),p(""),u([]),F.success("Route added successfully")}catch(t){F.error("Failed to save route."),console.log(t)}},l=async t=>{try{await P.delete(`https://turnup-admin.com/routes/${t}`,{withCredentials:!0}),n(a=>a.filter(r=>r.id!==t)),x?.id===t&&(i(null),u([]),k([])),F.success("Delete Route Successfully")}catch(a){console.error("Failed to delete route",a),F.error("Failed to delete route.")}},h=async t=>{if(t.length===0)return[];const a=t.filter(w=>!isNaN(w.lat)&&!isNaN(w.lng));if(a.length===0)return[];const D=((w,R)=>{const z=[];for(let f=0;f<w.length;f+=R)z.push(w.slice(f,f+R));return z})(a,100);let s=[];for(const w of D){const z=`https://roads.googleapis.com/v1/snapToRoads?path=${w.map(I=>`${I.lat},${I.lng}`).join("|")}&interpolate=true&key=AIzaSyAicbS4J0S5M2DRMdOsImk3FGYFb8tJCPY`,A=await(await fetch(z)).json();if(A.snappedPoints){const I=A.snappedPoints.map(Z=>({lat:Z.location.latitude,lng:Z.location.longitude}));s=[...s,...I]}}return s},T=async t=>{try{await P.patch(`https://turnup-admin.com/routes/${t}/toggle-disable`,{},{withCredentials:!0}),n(a=>{const r=a.find(s=>s.id===t);if(!r)return a;const D=!r.disabled;return a.map(s=>s.firstTerminal===r.firstTerminal&&s.secondTerminal===r.secondTerminal?{...s,disabled:s.id===t?D:!0}:s)}),F.success("Route status updated")}catch(a){console.error(a),F.error("Failed to update route status")}},M=b&&y&&m.length>=2;return e.jsxs(ve,{breadcrumbs:_e,children:[e.jsx(re,{title:"Map Route"}),e.jsxs(B,{className:"w-full max-w-4xl mx-auto m-6",children:[e.jsx(Y,{children:e.jsxs(V,{className:"flex items-center justify-between",children:["Create Route",e.jsxs(le,{variant:M?"default":"secondary",children:[m.length," stops"]})]})}),e.jsxs(X,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"first_terminal",children:"First Terminal"}),e.jsx($,{id:"first_terminal",name:"firstTerminal",placeholder:"First Terminal",value:b,onChange:t=>j(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"second_terminal",children:"Second Terminal"}),e.jsx($,{id:"second_terminal",name:"secondTerminal",placeholder:"Second Terminal",value:y,onChange:t=>p(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"route_color",children:"Route Color"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{type:"color",id:"route_color",value:S,onChange:t=>E(t.target.value),className:"w-12 h-10 p-1 cursor-pointer"}),e.jsx($,{type:"text",value:S,onChange:t=>E(t.target.value),placeholder:"#3b82f6",className:"flex-1"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{children:"Route Type"}),e.jsxs(Se,{value:_,onValueChange:t=>J(t),children:[e.jsx(Te,{children:e.jsx(Re,{placeholder:"Select route type"})}),e.jsxs(ke,{children:[e.jsx(H,{value:"main",children:"Main Route"}),e.jsx(H,{value:"festival",children:"Festival Route"}),e.jsx(H,{value:"detour",children:"Detour Route"}),e.jsx(H,{value:"emergency",children:"Emergency Route"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-lg bg-muted/30",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${m.length<2?"bg-orange-400":"bg-green-400"}`}),e.jsx("p",{className:"text-sm text-muted-foreground",children:m.length<2?"Add at least 2 stops to save and draw routes.":"Ready to save the route"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:[e.jsx(C,{onClick:U,disabled:!b||!y||m.length<2,children:"Save Route"}),e.jsx(C,{variant:"destructive",onClick:()=>v(t=>!t),disabled:m.length===0,children:"Clear Route"}),e.jsx($e,{})]})]})]}),x&&e.jsx(B,{className:"w-full max-w-4xl mx-auto mt-4",children:e.jsx(Y,{children:e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"text-blue-500",size:18}),"Route: ",x.firstTerminal," → ",x.secondTerminal]})})}),e.jsx("div",{className:"mt-6",children:e.jsx(Ee,{stops:m,setStops:u,clearTrigger:N,polylines:L,setPolylines:k,savedPolylines:x?[{id:x.id,path:x.polyline,color:x.color??"#3388ff"}]:[],snapToRoad:h,routeColor:S})}),e.jsx("div",{className:"m-4",children:e.jsx(C,{onClick:()=>d(!g),children:g?"Hide Routes Table":"Show Routes Table"})}),g&&e.jsx(Pe,{routes:o,onView:t=>{x?.id===t.id?(i(null),u([]),k([])):(u(t.stops.map(a=>({name:a.name,position:{lat:a.lat,lng:a.lng}}))),k([{id:t.id,path:t.polyline,color:t.color}]),i(t))},onDelete:l,onToggleDisable:T}),e.jsxs(B,{className:"m-10",children:[e.jsx(Y,{className:"pb-3",children:e.jsxs(V,{className:"flex items-center gap-2 text-lg",children:[e.jsx(he,{size:18}),"Quick Start Guide"]})}),e.jsxs(X,{className:"pt-0",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Q,{size:16,className:"text-blue-500"}),e.jsx("h3",{className:"font-medium text-base",children:"Creating a Route"})]}),e.jsxs("ol",{className:"text-sm space-y-2 list-decimal list-inside text-muted-foreground ml-6",children:[e.jsx("li",{children:"Enter start and end terminal names in the form"}),e.jsx("li",{children:"Choose a color for your route visualization"}),e.jsx("li",{children:"Click on the map to add stops along your route"}),e.jsx("li",{children:"Choose what type of route to determine to the commuters"}),e.jsx("li",{children:"Use Polyline in the map to draw along with the stops"}),e.jsx("li",{children:'Click "Save Route" when you have at least 2 stops'})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ce,{size:16,className:"text-green-500"}),e.jsx("h3",{className:"font-medium text-base",children:"Managing Routes"})]}),e.jsxs("ul",{className:"text-sm space-y-2 list-disc list-inside text-muted-foreground ml-6",children:[e.jsx("li",{children:'Click "View" to display a specific route on the map'}),e.jsx("li",{children:'Use "Delete" to remove routes you no longer need'}),e.jsx("li",{children:"Routes are displayed with your chosen color on the map"}),e.jsx("li",{children:"Routes are category based on your choose type"})]})]})]}),e.jsxs("div",{className:"mt-6 pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Me,{size:16,className:"text-purple-500"}),e.jsx("h3",{className:"font-medium text-base",children:"Tips & Best Practices"})]}),e.jsxs("ul",{className:"text-sm space-y-1 list-disc list-inside text-muted-foreground ml-6 grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsx("li",{children:"Add descriptive terminal names for easy identification"}),e.jsx("li",{children:"Use different colors for each route to distinguish them"}),e.jsx("li",{children:"Place stops in logical order along your intended path"}),e.jsx("li",{children:'Click "Map Guide" to have ideas of your routes'})]})]})]})]})]})}export{rt as default};
