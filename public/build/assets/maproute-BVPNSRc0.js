import{u as ne,r as d,j as e,a as P,H as re}from"./app-1MRgDCoG.js";import{u as oe,G as ie,d as ce,l as de,M as me,P as ue,I as he}from"./esm-Bf7os3r8.js";import{D as ee,a as te,b as se,c as ae,d as pe,e as ge,f as xe}from"./dialog-CBgQW4Yx.js";import{I as $}from"./input-uat8H0bH.js";import{B as S,c as O}from"./app-logo-icon-B9ACLFBI.js";import{C as V,a as B,b as Y,c as X}from"./card-D-iWcjch.js";import{B as le}from"./badge-lvXobgR_.js";import{T as fe,a as je,b as ye,c as be}from"./tabs-CAb-CAYh.js";import{M as Q}from"./map-pin-azoxIGEH.js";import{E as Ne,T as we}from"./trash-2-BjySlTDq.js";import{L as G}from"./label-2nCULgbN.js";import{a as ve,S as Ce,y as D}from"./app-layout-jbyp3_-h.js";import{S as Se,a as Te,b as Re,c as ke,d as H}from"./select-BBIEDA5d.js";import{R as Me}from"./route-BVhTgh9v.js";/* empty css            */import"./createLucideIcon-BJkW4F41.js";import"./index-C0uf9KPb.js";import"./index-Bn6qwD_D.js";import"./users-xrht6KLg.js";import"./index-CKXf0LIz.js";const Fe={width:"100%",height:"450px"},De={lat:10.6676,lng:122.9456},Le=["places","drawing"];function Ee({stops:m,setStops:o,clearTrigger:N,polylines:j,setPolylines:y,savedPolylines:p,routeColor:x}){const{isLoaded:b}=oe({googleMapsApiKey:"AIzaSyAicbS4J0S5M2DRMdOsImk3FGYFb8tJCPY",libraries:Le}),{appearance:u}=ne(),[g,v]=d.useState(!1),[C,M]=d.useState(null),[n,i]=d.useState(!1),[r,T]=d.useState(null),E=d.useRef([]);d.useEffect(()=>{const l=window.matchMedia("(prefers-color-scheme: dark)").matches;v(u==="dark"||u==="system"&&l)},[u]),d.useEffect(()=>{!p||p.length===0||y(l=>l.length===p.length&&l.every((R,F)=>{const t=p[F];return R.id===t.id&&R.path.length===t.path.length&&R.path.every((a,c)=>a.lat===t.path[c].lat&&a.lng===t.path[c].lng)})?l:p)},[p]),d.useEffect(()=>{N&&(y([]),o([]))},[N,o]),d.useEffect(()=>{if(!C||!p||p.length===0)return;E.current.forEach(h=>h.setMap(null)),E.current=[];const l=new google.maps.LatLngBounds;p.forEach(h=>{const R=h.path.map(t=>{const a=typeof t.lat=="string"?parseFloat(t.lat):t.lat,c=typeof t.lng=="string"?parseFloat(t.lng):t.lng;return l.extend({lat:a,lng:c}),{lat:a,lng:c}}),F=new google.maps.Polyline({path:R,strokeColor:h.color,strokeWeight:3,editable:!1,map:C});E.current.push(F)}),l.isEmpty()||C.fitBounds(l)},[C,p]);const _=l=>{if(!l.latLng)return;const h={lat:l.latLng.lat(),lng:l.latLng.lng()};T({position:h,name:""}),i(!0)},J=()=>{r&&r.name.trim()&&(o([...m,{name:r.name,position:r.position}]),i(!1),T(null))},U=l=>{M(l);const h=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.POLYLINE,drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT,drawingModes:[google.maps.drawing.OverlayType.POLYLINE,google.maps.drawing.OverlayType.MARKER]},polylineOptions:{strokeColor:"#3b82f6",strokeWeight:3,editable:!0,geodesic:!0}});h.setMap(l),google.maps.event.addListener(h,"overlaycomplete",async R=>{if(R.type===google.maps.drawing.OverlayType.POLYLINE){const F=R.overlay,t=F.getPath().getArray().map(c=>({lat:c.lat(),lng:c.lng()})),a={id:Date.now(),path:t,color:x};y(c=>[...c,a]),F.setMap(null)}})};return e.jsxs("div",{className:"flex justify-center py-6",children:[e.jsxs("div",{className:"w-full max-w-6xl rounded-2xl shadow-xl overflow-hidden border border-gray-200 dark:border-gray-700",children:[!b&&e.jsxs("div",{className:"relative h-[450px] flex items-center justify-center bg-gray-100 dark:bg-gray-800 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-blue-500"}),e.jsx("span",{className:"absolute mt-16 text-gray-700 dark:text-gray-200",children:"Loading map..."})]}),b&&e.jsxs(ie,{mapContainerStyle:Fe,center:De,zoom:12,onClick:_,onLoad:U,options:{styles:g?ce:de,disableDefaultUI:!0,zoomControl:!0,gestureHandling:"greedy"},children:[m.map((l,h)=>e.jsx(me,{position:l.position,title:l.name,label:{text:`${h+1}`,color:g?"#000000":"#FFFFFF",fontSize:"12px",fontWeight:"bold"},icon:{path:google.maps.SymbolPath.CIRCLE,scale:12,fillColor:g?"#FFD700":"#2196F3",fillOpacity:1,strokeWeight:2,strokeColor:g?"#fff":"#000"}},h)),j.map((l,h)=>e.jsx(ue,{path:l.path,options:{strokeColor:l.color,strokeOpacity:1,strokeWeight:3,editable:!0,geodesic:!0}},h))]})]}),e.jsx(ee,{open:n,onOpenChange:l=>{i(l),l||T(null)},children:e.jsxs(te,{children:[e.jsx(se,{children:e.jsx(ae,{children:"Add Stop"})}),e.jsx($,{placeholder:"Enter stop name",value:r?.name||"",onChange:l=>T(h=>h?{...h,name:l.target.value}:null)}),e.jsxs(pe,{children:[e.jsx(S,{variant:"outline",onClick:()=>{i(!1),T(null)},children:"Cancel"}),e.jsx(S,{onClick:J,disabled:!r?.name.trim(),children:"Save"})]})]})})]})}function ze({className:m,...o}){return e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{className:O("w-full caption-bottom text-sm",m),...o})})}function Oe({className:m,...o}){return e.jsx("thead",{className:O("[&_tr]:border-b",m),...o})}function Ae({className:m,...o}){return e.jsx("tbody",{className:O("[&_tr:last-child]:border-0",m),...o})}function q({className:m,...o}){return e.jsx("tr",{className:O("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",m),...o})}function W({className:m,...o}){return e.jsx("th",{className:O("h-10 px-2 text-left align-middle font-medium text-muted-foreground",m),...o})}function K({className:m,...o}){return e.jsx("td",{className:O("p-2 align-middle",m),...o})}function Pe({routes:m,onView:o,onDelete:N,onToggleDisable:j}){const[y,p]=d.useState({});if(m.length===0)return e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Q,{className:"mx-auto h-12 w-12 text-muted-foreground"}),e.jsx("h3",{className:"mt-2 text-sm font-semibold text-foreground",children:"No Routes"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Get started by creating your first route."})]});const x=m.reduce((u,g)=>{const v=`${g.firstTerminal}→${g.secondTerminal}`;return u[v]||(u[v]=[]),u[v].push(g),u},{}),b=["main","festival","detour","emergency"];return e.jsx("div",{className:"space-y-6",children:Object.entries(x).map(([u,g])=>{if(g.length===0)return null;const v=g[0].type,C=y[u]||v,M=g.find(n=>n.type===C)||g[0];return e.jsxs(V,{className:"shadow-md max-w-5xl mx-auto",style:{borderLeft:`6px solid ${M.color}`},children:[e.jsx(B,{children:e.jsx(Y,{className:"text-lg",children:u})}),e.jsx(X,{children:e.jsxs(fe,{value:C,onValueChange:n=>p(i=>({...i,[u]:n})),className:"w-full",children:[e.jsx(je,{className:"grid grid-cols-4 w-full mb-4",children:b.map(n=>g.some(i=>i.type===n)&&e.jsx(ye,{value:n,className:"capitalize",children:n},n))}),g.map(n=>e.jsxs(be,{value:n.type,children:[e.jsxs("div",{className:"flex justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(le,{variant:"secondary",children:[n.stops.length," stops"]}),e.jsx("div",{className:"w-4 h-4 rounded-full border",style:{backgroundColor:n.color}})]}),e.jsxs("div",{className:"flex gap-2",children:[o&&e.jsxs(S,{size:"sm",variant:"outline",onClick:()=>o(n),children:[e.jsx(Ne,{className:"w-4 h-4 mr-1"})," View"]}),j&&e.jsx(S,{size:"sm",variant:n.disabled?"outline":"secondary",onClick:()=>j(n.id),children:n.disabled?"Enable":"Disable"}),e.jsxs(S,{size:"sm",variant:"destructive",onClick:()=>N(n.id),children:[e.jsx(we,{className:"w-4 h-4 mr-1"})," Delete"]})]})]}),e.jsx("div",{className:"rounded-md border max-h-64 overflow-y-auto",children:e.jsxs(ze,{className:"min-w-full",children:[e.jsx(Oe,{className:"sticky top-0 z-10 bg-background",children:e.jsxs(q,{className:"bg-muted/30",children:[e.jsx(W,{children:"#"}),e.jsx(W,{children:"Stop Name"}),e.jsx(W,{children:"Coordinates"})]})}),e.jsx(Ae,{children:n.stops.map((i,r)=>e.jsxs(q,{className:"hover:bg-muted/20",children:[e.jsx(K,{className:"text-muted-foreground",children:r+1}),e.jsx(K,{children:i.name||"Unnamed Stop"}),e.jsx(K,{className:"font-mono text-sm",children:i.lat&&i.lng?`${i.lat.toFixed(5)}, ${i.lng.toFixed(5)}`:"No coordinates"})]},r))})]})})]},n.id))]})})]},u)})})}function $e(){const m=[{name:"Fortune Towne - Central Market",image:"/fortunetowne.jpg"},{name:"Homesite - Central Market",image:"/homesite.jpg"},{name:"Granada - Burgos",image:"/burgosgranada.jpg"}],[o,N]=d.useState(0),[j,y]=d.useState(!1),[p,x]=d.useState({x:0,y:0}),[b,u]=d.useState(null),g=()=>{N(r=>r===0?m.length-1:r-1),y(!1),x({x:0,y:0})},v=()=>{N(r=>r===m.length-1?0:r+1),y(!1),x({x:0,y:0})},C=r=>{j&&(r.preventDefault(),u({x:r.clientX-p.x,y:r.clientY-p.y}))},M=r=>{!j||!b||x({x:r.clientX-b.x,y:r.clientY-b.y})},n=()=>u(null),i=()=>u(null);return e.jsxs(ee,{children:[e.jsx(ge,{asChild:!0,children:e.jsx(S,{children:"Open Map Guide"})}),e.jsxs(te,{className:"max-w-5xl",children:[e.jsxs(se,{children:[e.jsx(ae,{className:"text-xl font-semibold text-center",children:"Map Route Guide"}),e.jsx(xe,{className:"text-center",children:"View and navigate through jeepney routes with zoom and pan functionality."})]}),e.jsxs("div",{className:"relative mt-4 flex flex-col items-center overflow-hidden w-full max-h-[600px] rounded-lg",onMouseMove:M,onMouseUp:n,onMouseLeave:i,children:[e.jsx("img",{src:m[o].image,alt:m[o].name,className:`object-cover cursor-${j?"grab":"zoom-in"} transition-transform duration-300`,style:{width:"100%",maxHeight:"600px",transform:`scale(${j?2:1}) translate(${p.x/(j?2:1)}px, ${p.y/(j?2:1)}px)`,cursor:j?"grab":"zoom-in"},onClick:()=>y(r=>!r),onMouseDown:C}),e.jsx("p",{className:"mt-4 text-center text-lg font-medium",children:m[o].name}),e.jsxs("div",{className:"absolute top-1/2 w-full flex justify-between px-6 -translate-y-1/2",children:[e.jsx(S,{variant:"outline",size:"lg",onClick:g,children:"◀"}),e.jsx(S,{variant:"outline",size:"lg",onClick:v,children:"▶"})]})]})]})]})}const _e=[{title:"Map Route",href:"/maproute"}];function rt(){const[m,o]=d.useState([]),[N,j]=d.useState(""),[y,p]=d.useState(""),[x,b]=d.useState([]),[u,g]=d.useState(!0),[v,C]=d.useState(!1),[M,n]=d.useState([]),[i,r]=d.useState(null),[T,E]=d.useState("#3388ff"),[_,J]=d.useState("main");d.useEffect(()=>{P.get("https://turnup-admin.com/sanctum/csrf-cookie",{withCredentials:!0}).then(()=>console.log("CSRF cookie set")).catch(t=>console.error(t))},[]),d.useEffect(()=>{(async()=>{try{const c=await(await fetch("/routes")).json(),L=await Promise.all(c.map(async(s,w)=>{let k=[];if(typeof s.polyline=="string")try{k=JSON.parse(s.polyline).map(A=>({lat:Number(A.lat),lng:Number(A.lng)}))}catch{k=[]}else Array.isArray(s.polyline)?k=s.polyline.map(f=>({lat:Number(f.lat),lng:Number(f.lng)})):s.polyline&&(k=[{lat:Number(s.polyline.lat),lng:Number(s.polyline.lng)}]);const z=await h(k.map(f=>({lat:Number(f.lat),lng:Number(f.lng)})));return{id:s.id??w,firstTerminal:s.first_terminal,secondTerminal:s.second_terminal,polyline:z,stops:s.stops.map(f=>({name:f.name,lat:Number(f.lat),lng:Number(f.lng)})),color:s.color??"#3388ff",type:s.type??"main"}}));o(L)}catch(a){console.error("Failed to fetch routes",a)}})()},[]);const U=async()=>{if(!N||!y){D.error("Please fill in both terminals");return}if(x.length<2){D.error("Please add at least 2 stops before saving the route");return}try{await P.get("https://turnup-admin.com/sanctum/csrf-cookie",{withCredentials:!0});const t={first_terminal:N,second_terminal:y,polyline:M[0]?.path??[],stops:x.map(s=>({name:s.name,lat:s.position.lat,lng:s.position.lng})),color:T,type:_},a=await P.post("https://turnup-admin.com/routes",t,{withCredentials:!0});let c=[];if(typeof a.data.polyline=="string")try{c=JSON.parse(a.data.polyline).map(w=>({lat:Number(w.lat),lng:Number(w.lng)}))}catch{c=[]}else Array.isArray(a.data.polyline)?c=a.data.polyline.map(s=>({lat:Number(s.lat),lng:Number(s.lng)})):a.data.polyline&&(c=[{lat:Number(a.data.polyline.lat),lng:Number(a.data.polyline.lng)}]);const L={id:a.data.id??Date.now(),firstTerminal:a.data.first_terminal,secondTerminal:a.data.second_terminal,polyline:c.map(s=>({lat:Number(s.lat),lng:Number(s.lng)})),stops:a.data.stops.map(s=>({name:s.name,lat:Number(s.lat),lng:Number(s.lng)})),color:"#3388ff",type:a.data.type??"main"};o(s=>[...s,L]),j(""),p(""),b([]),D.success("Route added successfully")}catch(t){D.error("Failed to save route."),console.log(t)}},l=async t=>{try{await P.delete(`https://turnup-admin.com/routes/${t}`,{withCredentials:!0}),o(a=>a.filter(c=>c.id!==t)),i?.id===t&&(r(null),b([]),n([])),D.success("Delete Route Successfully")}catch(a){console.error("Failed to delete route",a),D.error("Failed to delete route.")}},h=async t=>{if(t.length===0)return[];const a=t.filter(w=>!isNaN(w.lat)&&!isNaN(w.lng));if(a.length===0)return[];const L=((w,k)=>{const z=[];for(let f=0;f<w.length;f+=k)z.push(w.slice(f,f+k));return z})(a,100);let s=[];for(const w of L){const z=`https://roads.googleapis.com/v1/snapToRoads?path=${w.map(I=>`${I.lat},${I.lng}`).join("|")}&interpolate=true&key=AIzaSyAicbS4J0S5M2DRMdOsImk3FGYFb8tJCPY`,A=await(await fetch(z)).json();if(A.snappedPoints){const I=A.snappedPoints.map(Z=>({lat:Z.location.latitude,lng:Z.location.longitude}));s=[...s,...I]}}return s},R=async t=>{try{await P.patch(`https://turnup-admin.com/routes/${t}/toggle-disable`,{},{withCredentials:!0}),o(a=>{const c=a.find(s=>s.id===t);if(!c)return a;const L=!c.disabled;return a.map(s=>s.firstTerminal===c.firstTerminal&&s.secondTerminal===c.secondTerminal?{...s,disabled:s.id===t?L:!0}:s)}),D.success("Route status updated")}catch(a){console.error(a),D.error("Failed to update route status")}},F=N&&y&&x.length>=2;return e.jsxs(ve,{breadcrumbs:_e,children:[e.jsx(re,{title:"Map Route"}),e.jsxs(V,{className:"w-full max-w-4xl mx-auto m-6",children:[e.jsx(B,{children:e.jsxs(Y,{className:"flex items-center justify-between",children:["Create Route",e.jsxs(le,{variant:F?"default":"secondary",children:[x.length," stops"]})]})}),e.jsxs(X,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"first_terminal",children:"First Terminal"}),e.jsx($,{id:"first_terminal",name:"firstTerminal",placeholder:"First Terminal",value:N,onChange:t=>j(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"second_terminal",children:"Second Terminal"}),e.jsx($,{id:"second_terminal",name:"secondTerminal",placeholder:"Second Terminal",value:y,onChange:t=>p(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"route_color",children:"Route Color"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{type:"color",id:"route_color",value:T,onChange:t=>E(t.target.value),className:"w-12 h-10 p-1 cursor-pointer"}),e.jsx($,{type:"text",value:T,onChange:t=>E(t.target.value),placeholder:"#3b82f6",className:"flex-1"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{children:"Route Type"}),e.jsxs(Se,{value:_,onValueChange:t=>J(t),children:[e.jsx(Te,{children:e.jsx(Re,{placeholder:"Select route type"})}),e.jsxs(ke,{children:[e.jsx(H,{value:"main",children:"Main Route"}),e.jsx(H,{value:"festival",children:"Festival Route"}),e.jsx(H,{value:"detour",children:"Detour Route"}),e.jsx(H,{value:"emergency",children:"Emergency Route"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-lg bg-muted/30",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${x.length<2?"bg-orange-400":"bg-green-400"}`}),e.jsx("p",{className:"text-sm text-muted-foreground",children:x.length<2?"Add at least 2 stops to save and draw routes.":"Ready to save the route"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:[e.jsx(S,{onClick:U,disabled:!N||!y||x.length<2,children:"Save Route"}),e.jsx(S,{variant:"destructive",onClick:()=>C(t=>!t),disabled:x.length===0,children:"Clear Route"}),e.jsx($e,{})]})]})]}),i&&e.jsx(V,{className:"w-full max-w-4xl mx-auto mt-4",children:e.jsx(B,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"text-blue-500",size:18}),"Route: ",i.firstTerminal," → ",i.secondTerminal]})})}),e.jsx("div",{className:"mt-6",children:e.jsx(Ee,{stops:x,setStops:b,clearTrigger:v,polylines:M,setPolylines:n,savedPolylines:i?[{id:i.id,path:i.polyline,color:i.color??"#3388ff"}]:[],snapToRoad:h,routeColor:T})}),e.jsx("div",{className:"m-4",children:e.jsx(S,{onClick:()=>g(!u),children:u?"Hide Routes Table":"Show Routes Table"})}),u&&e.jsx(Pe,{routes:m,onView:t=>{i?.id===t.id?(r(null),b([]),n([])):(b(t.stops.map(a=>({name:a.name,position:{lat:a.lat,lng:a.lng}}))),n([{id:t.id,path:t.polyline,color:t.color}]),r(t))},onDelete:l,onToggleDisable:R}),e.jsxs(V,{className:"m-10",children:[e.jsx(B,{className:"pb-3",children:e.jsxs(Y,{className:"flex items-center gap-2 text-lg",children:[e.jsx(he,{size:18}),"Quick Start Guide"]})}),e.jsxs(X,{className:"pt-0",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Q,{size:16,className:"text-blue-500"}),e.jsx("h3",{className:"font-medium text-base",children:"Creating a Route"})]}),e.jsxs("ol",{className:"text-sm space-y-2 list-decimal list-inside text-muted-foreground ml-6",children:[e.jsx("li",{children:"Enter start and end terminal names in the form"}),e.jsx("li",{children:"Choose a color for your route visualization"}),e.jsx("li",{children:"Click on the map to add stops along your route"}),e.jsx("li",{children:"Choose what type of route to determine to the commuters"}),e.jsx("li",{children:"Use Polyline in the map to draw along with the stops"}),e.jsx("li",{children:'Click "Save Route" when you have at least 2 stops'})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ce,{size:16,className:"text-green-500"}),e.jsx("h3",{className:"font-medium text-base",children:"Managing Routes"})]}),e.jsxs("ul",{className:"text-sm space-y-2 list-disc list-inside text-muted-foreground ml-6",children:[e.jsx("li",{children:'Click "View" to display a specific route on the map'}),e.jsx("li",{children:'Use "Delete" to remove routes you no longer need'}),e.jsx("li",{children:"Routes are displayed with your chosen color on the map"}),e.jsx("li",{children:"Routes are category based on your choose type"})]})]})]}),e.jsxs("div",{className:"mt-6 pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Me,{size:16,className:"text-purple-500"}),e.jsx("h3",{className:"font-medium text-base",children:"Tips & Best Practices"})]}),e.jsxs("ul",{className:"text-sm space-y-1 list-disc list-inside text-muted-foreground ml-6 grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsx("li",{children:"Add descriptive terminal names for easy identification"}),e.jsx("li",{children:"Use different colors for each route to distinguish them"}),e.jsx("li",{children:"Place stops in logical order along your intended path"}),e.jsx("li",{children:'Click "Map Guide" to have ideas of your routes'})]})]})]})]})]})}export{rt as default};
