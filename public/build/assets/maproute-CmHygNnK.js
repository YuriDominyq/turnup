import{u as ie,r as o,j as e,a as $,H as ce}from"./app-B2N4sAYZ.js";import{u as de,G as me,d as ue,l as he,M as pe,P as xe,I as ge}from"./esm-fqIZzz3i.js";import{D as q,a as ee,b as te,c as se,d as fe,e as je,f as ye}from"./dialog-DSYqQp4v.js";import{I}from"./input-BGNtri1p.js";import{B as S,c as O}from"./app-logo-icon-CY43iG4N.js";import{C as H,a as B,b as Y,c as X}from"./card-BrjrbenX.js";import{B as ae}from"./badge-DjlXsWkK.js";import{S as le,a as ne,b as re,c as oe,d as M}from"./select-T-bD6b8F.js";import{M as V}from"./map-pin-BuL-REzp.js";import{E as Ne,T as be}from"./trash-2-Ca1b-AKi.js";import{L as G}from"./label-8oNYjwcA.js";import{a as ve,S as we,y as L}from"./app-layout-BxXKLFio.js";import{R as Se}from"./route-CfRQ2nC8.js";/* empty css            */import"./createLucideIcon-BP_FjVEE.js";import"./index-CL8PLYXT.js";import"./index--TLbeRcM.js";import"./index-Ctqs1PFM.js";import"./users-Bb2zxgm6.js";const Ce={width:"100%",height:"450px"},Re={lat:10.6676,lng:122.9456},Te=["places","drawing"];function ke({stops:i,setStops:r,clearTrigger:N,polylines:p,setPolylines:j,savedPolylines:d,routeColor:l}){const{isLoaded:u}=de({googleMapsApiKey:"AIzaSyAicbS4J0S5M2DRMdOsImk3FGYFb8tJCPY",libraries:Te}),{appearance:y}=ie(),[R,z]=o.useState(!1),[T,F]=o.useState(null),[k,x]=o.useState(!1),[c,v]=o.useState(null),D=o.useRef([]);o.useEffect(()=>{const n=window.matchMedia("(prefers-color-scheme: dark)").matches;z(y==="dark"||y==="system"&&n)},[y]),o.useEffect(()=>{!d||d.length===0||j(n=>n.length===d.length&&n.every((w,t)=>{const s=d[t];return w.id===s.id&&w.path.length===s.path.length&&w.path.every((h,g)=>h.lat===s.path[g].lat&&h.lng===s.path[g].lng)})?n:d)},[d]),o.useEffect(()=>{N&&(j([]),r([]))},[N,r]),o.useEffect(()=>{if(!T||!d||d.length===0)return;D.current.forEach(m=>m.setMap(null)),D.current=[];const n=new google.maps.LatLngBounds;d.forEach(m=>{const w=m.path.map(s=>{const h=typeof s.lat=="string"?parseFloat(s.lat):s.lat,g=typeof s.lng=="string"?parseFloat(s.lng):s.lng;return n.extend({lat:h,lng:g}),{lat:h,lng:g}}),t=new google.maps.Polyline({path:w,strokeColor:m.color,strokeWeight:3,editable:!1,map:T});D.current.push(t)}),n.isEmpty()||T.fitBounds(n)},[T,d]);const P=n=>{if(!n.latLng)return;const m={lat:n.latLng.lat(),lng:n.latLng.lng()};v({position:m,name:""}),x(!0)},J=()=>{c&&c.name.trim()&&(r([...i,{name:c.name,position:c.position}]),x(!1),v(null))},U=n=>{F(n);const m=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.POLYLINE,drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT,drawingModes:[google.maps.drawing.OverlayType.POLYLINE,google.maps.drawing.OverlayType.MARKER]},polylineOptions:{strokeColor:"#3b82f6",strokeWeight:3,editable:!0,geodesic:!0}});m.setMap(n),google.maps.event.addListener(m,"overlaycomplete",async w=>{if(w.type===google.maps.drawing.OverlayType.POLYLINE){const t=w.overlay,s=t.getPath().getArray().map(g=>({lat:g.lat(),lng:g.lng()})),h={id:Date.now(),path:s,color:l};j(g=>[...g,h]),t.setMap(null)}})};return e.jsxs("div",{className:"flex justify-center py-6",children:[e.jsxs("div",{className:"w-full max-w-6xl rounded-2xl shadow-xl overflow-hidden border border-gray-200 dark:border-gray-700",children:[!u&&e.jsxs("div",{className:"relative h-[450px] flex items-center justify-center bg-gray-100 dark:bg-gray-800 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-blue-500"}),e.jsx("span",{className:"absolute mt-16 text-gray-700 dark:text-gray-200",children:"Loading map..."})]}),u&&e.jsxs(me,{mapContainerStyle:Ce,center:Re,zoom:12,onClick:P,onLoad:U,options:{styles:R?ue:he,disableDefaultUI:!0,zoomControl:!0,gestureHandling:"greedy"},children:[i.map((n,m)=>e.jsx(pe,{position:n.position,title:n.name,label:{text:`${m+1}`,color:R?"#000000":"#FFFFFF",fontSize:"12px",fontWeight:"bold"},icon:{path:google.maps.SymbolPath.CIRCLE,scale:12,fillColor:R?"#FFD700":"#2196F3",fillOpacity:1,strokeWeight:2,strokeColor:R?"#fff":"#000"}},m)),p.map((n,m)=>e.jsx(xe,{path:n.path,options:{strokeColor:n.color,strokeOpacity:1,strokeWeight:3,editable:!0,geodesic:!0}},m))]})]}),e.jsx(q,{open:k,onOpenChange:n=>{x(n),n||v(null)},children:e.jsxs(ee,{children:[e.jsx(te,{children:e.jsx(se,{children:"Add Stop"})}),e.jsx(I,{placeholder:"Enter stop name",value:c?.name||"",onChange:n=>v(m=>m?{...m,name:n.target.value}:null)}),e.jsxs(fe,{children:[e.jsx(S,{variant:"outline",onClick:()=>{x(!1),v(null)},children:"Cancel"}),e.jsx(S,{onClick:J,disabled:!c?.name.trim(),children:"Save"})]})]})})]})}function Me({className:i,...r}){return e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{className:O("w-full caption-bottom text-sm",i),...r})})}function Fe({className:i,...r}){return e.jsx("thead",{className:O("[&_tr]:border-b",i),...r})}function De({className:i,...r}){return e.jsx("tbody",{className:O("[&_tr:last-child]:border-0",i),...r})}function Z({className:i,...r}){return e.jsx("tr",{className:O("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",i),...r})}function W({className:i,...r}){return e.jsx("th",{className:O("h-10 px-2 text-left align-middle font-medium text-muted-foreground",i),...r})}function K({className:i,...r}){return e.jsx("td",{className:O("p-2 align-middle",i),...r})}function Ee({routes:i,onView:r,onDelete:N}){const[p,j]=o.useState("main"),d=i.filter(l=>l.type===p);return i.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(V,{className:"mx-auto h-12 w-12 text-muted-foreground"}),e.jsx("h3",{className:"mt-2 text-sm font-semibold text-foreground",children:"No Routes"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Get started by creating your first route."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs(le,{value:p,onValueChange:l=>j(l),children:[e.jsx(ne,{children:e.jsx(re,{placeholder:"Select Route Type"})}),e.jsxs(oe,{children:[e.jsx(M,{value:"main",children:"Main"}),e.jsx(M,{value:"festival",children:"Festival"}),e.jsx(M,{value:"detour",children:"Detour"}),e.jsx(M,{value:"emergency",children:"Emergency"})]})]})}),d.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(V,{className:"mx-auto h-12 w-12 text-muted-foreground"}),e.jsx("h3",{className:"mt-2 text-sm font-semibold text-foreground",children:"No Routes"}),e.jsxs("p",{className:"mt-1 text-sm text-muted-foreground",children:["No ",p," routes available."]})]}),d.map(l=>e.jsxs(H,{className:"shadow-md max-w-5xl mx-auto",style:{borderLeftColor:l.color},children:[e.jsx(B,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs(Y,{className:"flex items-center gap-2 text-lg",children:[e.jsx("span",{className:"truncate",children:l.firstTerminal}),e.jsx("span",{className:"text-muted-foreground",children:"→"}),e.jsx("span",{className:"truncate",children:l.secondTerminal})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs(ae,{variant:"secondary",className:"text-xs",children:[l.stops.length," stops"]}),e.jsx("div",{className:"w-4 h-4 rounded-full border border-border",style:{backgroundColor:l.color},"aria-label":`Route color: ${l.color}`})]})]}),e.jsxs("div",{className:"flex flex-shrink-0 gap-2",children:[r&&e.jsxs(S,{size:"sm",variant:"outline",onClick:()=>r(l),className:"whitespace-nowrap",children:[e.jsx(Ne,{className:"w-4 h-4 mr-1"}),"View"]}),e.jsxs(S,{size:"sm",variant:"destructive",onClick:()=>N(l.id),className:"whitespace-nowrap",children:[e.jsx(be,{className:"w-4 h-4 mr-1"}),"Delete"]})]})]})}),e.jsx(X,{className:"pt-0",children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(Me,{children:[e.jsx(Fe,{children:e.jsxs(Z,{className:"bg-muted/30",children:[e.jsx(W,{className:"font-semibold",children:"#"}),e.jsx(W,{className:"font-semibold",children:"Stop Name"}),e.jsx(W,{className:"font-semibold",children:"Coordinates"})]})}),e.jsx(De,{children:l.stops.map((u,y)=>e.jsxs(Z,{className:"hover:bg-muted/20",children:[e.jsx(K,{className:"font-medium text-muted-foreground",children:y+1}),e.jsx(K,{className:"font-medium",children:u.name||"Unnamed Stop"}),e.jsx(K,{className:"font-mono text-sm",children:u.lat!=null&&u.lng!=null?`${Number(u.lat).toFixed(5)}, ${Number(u.lng).toFixed(5)}`:"No coordinates"})]},y))})]})})})]},l.id))]})}function Le(){const i=[{name:"Fortune Towne - Central Market",image:"/fortunetowne.jpg"},{name:"Homesite - Central Market",image:"/homesite.jpg"},{name:"Granada - Burgos",image:"/burgosgranada.jpg"}],[r,N]=o.useState(0),[p,j]=o.useState(!1),[d,l]=o.useState({x:0,y:0}),[u,y]=o.useState(null),R=()=>{N(c=>c===0?i.length-1:c-1),j(!1),l({x:0,y:0})},z=()=>{N(c=>c===i.length-1?0:c+1),j(!1),l({x:0,y:0})},T=c=>{p&&(c.preventDefault(),y({x:c.clientX-d.x,y:c.clientY-d.y}))},F=c=>{!p||!u||l({x:c.clientX-u.x,y:c.clientY-u.y})},k=()=>y(null),x=()=>y(null);return e.jsxs(q,{children:[e.jsx(je,{asChild:!0,children:e.jsx(S,{children:"Open Map Guide"})}),e.jsxs(ee,{className:"max-w-5xl",children:[e.jsxs(te,{children:[e.jsx(se,{className:"text-xl font-semibold text-center",children:"Map Route Guide"}),e.jsx(ye,{className:"text-center",children:"View and navigate through jeepney routes with zoom and pan functionality."})]}),e.jsxs("div",{className:"relative mt-4 flex flex-col items-center overflow-hidden w-full max-h-[600px] rounded-lg",onMouseMove:F,onMouseUp:k,onMouseLeave:x,children:[e.jsx("img",{src:i[r].image,alt:i[r].name,className:`object-cover cursor-${p?"grab":"zoom-in"} transition-transform duration-300`,style:{width:"100%",maxHeight:"600px",transform:`scale(${p?2:1}) translate(${d.x/(p?2:1)}px, ${d.y/(p?2:1)}px)`,cursor:p?"grab":"zoom-in"},onClick:()=>j(c=>!c),onMouseDown:T}),e.jsx("p",{className:"mt-4 text-center text-lg font-medium",children:i[r].name}),e.jsxs("div",{className:"absolute top-1/2 w-full flex justify-between px-6 -translate-y-1/2",children:[e.jsx(S,{variant:"outline",size:"lg",onClick:R,children:"◀"}),e.jsx(S,{variant:"outline",size:"lg",onClick:z,children:"▶"})]})]})]})]})}const Oe=[{title:"Map Route",href:"/maproute"}];function et(){const[i,r]=o.useState([]),[N,p]=o.useState(""),[j,d]=o.useState(""),[l,u]=o.useState([]),[y,R]=o.useState(!0),[z,T]=o.useState(!1),[F,k]=o.useState([]),[x,c]=o.useState(null),[v,D]=o.useState("#3388ff"),[P,J]=o.useState("main");o.useEffect(()=>{$.get("https://turnup-admin.com/sanctum/csrf-cookie",{withCredentials:!0}).then(()=>console.log("CSRF cookie set")).catch(t=>console.error(t))},[]),o.useEffect(()=>{(async()=>{try{const h=await(await fetch("/routes")).json(),g=await Promise.all(h.map(async(a,b)=>{let C=[];if(typeof a.polyline=="string")try{C=JSON.parse(a.polyline).map(A=>({lat:Number(A.lat),lng:Number(A.lng)}))}catch{C=[]}else Array.isArray(a.polyline)?C=a.polyline.map(f=>({lat:Number(f.lat),lng:Number(f.lng)})):a.polyline&&(C=[{lat:Number(a.polyline.lat),lng:Number(a.polyline.lng)}]);const E=await m(C.map(f=>({lat:Number(f.lat),lng:Number(f.lng)})));return{id:a.id??b,firstTerminal:a.first_terminal,secondTerminal:a.second_terminal,polyline:E,stops:a.stops.map(f=>({name:f.name,lat:Number(f.lat),lng:Number(f.lng)})),color:a.color??"#3388ff",type:a.type??"main"}}));r(g)}catch(s){console.error("Failed to fetch routes",s)}})()},[]);const U=async()=>{if(!N||!j){L.error("Please fill in both terminals");return}if(l.length<2){L.error("Please add at least 2 stops before saving the route");return}try{await $.get("https://turnup-admin.com/sanctum/csrf-cookie",{withCredentials:!0});const t={first_terminal:N,second_terminal:j,polyline:F[0]?.path??[],stops:l.map(a=>({name:a.name,lat:a.position.lat,lng:a.position.lng})),color:v},s=await $.post("https://turnup-admin.com/routes",t,{withCredentials:!0});let h=[];if(typeof s.data.polyline=="string")try{h=JSON.parse(s.data.polyline).map(b=>({lat:Number(b.lat),lng:Number(b.lng)}))}catch{h=[]}else Array.isArray(s.data.polyline)?h=s.data.polyline.map(a=>({lat:Number(a.lat),lng:Number(a.lng)})):s.data.polyline&&(h=[{lat:Number(s.data.polyline.lat),lng:Number(s.data.polyline.lng)}]);const g={id:s.data.id??Date.now(),firstTerminal:s.data.first_terminal,secondTerminal:s.data.second_terminal,polyline:h.map(a=>({lat:Number(a.lat),lng:Number(a.lng)})),stops:s.data.stops.map(a=>({name:a.name,lat:Number(a.lat),lng:Number(a.lng)})),color:"#3388ff",type:s.data.type??"main"};r(a=>[...a,g]),p(""),d(""),u([]),L.success("Route added successfully")}catch(t){L.error("Failed to save route."),console.log(t)}},n=async t=>{try{await $.delete(`https://turnup-admin.com/routes/${t}`,{withCredentials:!0}),r(s=>s.filter(h=>h.id!==t)),x?.id===t&&(c(null),u([]),k([])),L.success("Delete Route Successfully")}catch(s){console.error("Failed to delete route",s),L.error("Failed to delete route.")}},m=async t=>{if(t.length===0)return[];const s=t.filter(b=>!isNaN(b.lat)&&!isNaN(b.lng));if(s.length===0)return[];const g=((b,C)=>{const E=[];for(let f=0;f<b.length;f+=C)E.push(b.slice(f,f+C));return E})(s,100);let a=[];for(const b of g){const E=`https://roads.googleapis.com/v1/snapToRoads?path=${b.map(_=>`${_.lat},${_.lng}`).join("|")}&interpolate=true&key=AIzaSyAicbS4J0S5M2DRMdOsImk3FGYFb8tJCPY`,A=await(await fetch(E)).json();if(A.snappedPoints){const _=A.snappedPoints.map(Q=>({lat:Q.location.latitude,lng:Q.location.longitude}));a=[...a,..._]}}return a},w=N&&j&&l.length>=2;return e.jsxs(ve,{breadcrumbs:Oe,children:[e.jsx(ce,{title:"Map Route"}),e.jsxs(H,{className:"w-full max-w-4xl mx-auto m-6",children:[e.jsx(B,{children:e.jsxs(Y,{className:"flex items-center justify-between",children:["Create Route",e.jsxs(ae,{variant:w?"default":"secondary",children:[l.length," stops"]})]})}),e.jsxs(X,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"first_terminal",children:"First Terminal"}),e.jsx(I,{id:"first_terminal",name:"firstTerminal",placeholder:"First Terminal",value:N,onChange:t=>p(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"second_terminal",children:"Second Terminal"}),e.jsx(I,{id:"second_terminal",name:"secondTerminal",placeholder:"Second Terminal",value:j,onChange:t=>d(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"route_color",children:"Route Color"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{type:"color",id:"route_color",value:v,onChange:t=>D(t.target.value),className:"w-12 h-10 p-1 cursor-pointer"}),e.jsx(I,{type:"text",value:v,onChange:t=>D(t.target.value),placeholder:"#3b82f6",className:"flex-1"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{children:"Route Type"}),e.jsxs(le,{value:P,onValueChange:t=>J(t),children:[e.jsx(ne,{children:e.jsx(re,{placeholder:"Select route type"})}),e.jsxs(oe,{children:[e.jsx(M,{value:"main",children:"Main Route"}),e.jsx(M,{value:"festival",children:"Festival Route"}),e.jsx(M,{value:"detour",children:"Detour Route"}),e.jsx(M,{value:"emergency",children:"Emergency Route"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-lg bg-muted/30",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${l.length<2?"bg-orange-400":"bg-green-400"}`}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l.length<2?"Add at least 2 stops to save and draw routes.":"Ready to save the route"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:[e.jsx(S,{onClick:U,disabled:!N||!j||l.length<2,children:"Save Route"}),e.jsx(S,{variant:"destructive",onClick:()=>T(t=>!t),disabled:l.length===0,children:"Clear Route"}),e.jsx(Le,{})]})]})]}),x&&e.jsx(H,{className:"w-full max-w-4xl mx-auto mt-4",children:e.jsx(B,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"text-blue-500",size:18}),"Route: ",x.firstTerminal," → ",x.secondTerminal]})})}),e.jsx("div",{className:"mt-6",children:e.jsx(ke,{stops:l,setStops:u,clearTrigger:z,polylines:F,setPolylines:k,savedPolylines:x?[{id:x.id,path:x.polyline,color:x.color??"#3388ff"}]:[],snapToRoad:m,routeColor:v})}),e.jsx("div",{className:"m-4",children:e.jsx(S,{onClick:()=>R(!y),children:y?"Hide Routes Table":"Show Routes Table"})}),y&&e.jsx(Ee,{routes:i.filter(t=>t.type===P),onView:t=>{x?.id===t.id?(c(null),u([]),k([])):(u(t.stops.map(s=>({name:s.name,position:{lat:s.lat,lng:s.lng}}))),k([{id:t.id,path:t.polyline,color:t.color}]),c(t))},onDelete:n}),e.jsxs(H,{className:"m-10",children:[e.jsx(B,{className:"pb-3",children:e.jsxs(Y,{className:"flex items-center gap-2 text-lg",children:[e.jsx(ge,{size:18}),"Quick Start Guide"]})}),e.jsxs(X,{className:"pt-0",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(V,{size:16,className:"text-blue-500"}),e.jsx("h3",{className:"font-medium text-base",children:"Creating a Route"})]}),e.jsxs("ol",{className:"text-sm space-y-2 list-decimal list-inside text-muted-foreground ml-6",children:[e.jsx("li",{children:"Enter start and end terminal names in the form"}),e.jsx("li",{children:"Choose a color for your route visualization"}),e.jsx("li",{children:"Click on the map to add stops along your route"}),e.jsx("li",{children:"Drag stops to adjust their positions if needed"}),e.jsx("li",{children:'Click "Save Route" when you have at least 2 stops'})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(we,{size:16,className:"text-green-500"}),e.jsx("h3",{className:"font-medium text-base",children:"Managing Routes"})]}),e.jsxs("ul",{className:"text-sm space-y-2 list-disc list-inside text-muted-foreground ml-6",children:[e.jsx("li",{children:'Use "Show Routes" to view all your saved routes'}),e.jsx("li",{children:'Click "View" to display a specific route on the map'}),e.jsx("li",{children:'Use "Delete" to remove routes you no longer need'}),e.jsx("li",{children:"Routes are displayed with your chosen color on the map"})]})]})]}),e.jsxs("div",{className:"mt-6 pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Se,{size:16,className:"text-purple-500"}),e.jsx("h3",{className:"font-medium text-base",children:"Tips & Best Practices"})]}),e.jsxs("ul",{className:"text-sm space-y-1 list-disc list-inside text-muted-foreground ml-6 grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsx("li",{children:"Add descriptive terminal names for easy identification"}),e.jsx("li",{children:"Use different colors for each route to distinguish them"}),e.jsx("li",{children:"Place stops in logical order along your intended path"}),e.jsx("li",{children:"Test your route by viewing it before finalizing"})]})]})]})]})]})}export{et as default};
