import{u as ce,r as o,j as e,a as $,H as de}from"./app-DG0cS4h7.js";import{u as me,G as ue,d as pe,l as he,M as xe,P as ge,I as fe}from"./esm-Cz9Xqguu.js";import{D as ee,a as te,b as se,c as ae,d as je,e as ye,f as be}from"./dialog-B74B_Bjh.js";import{I as P}from"./input-jyWXrC7J.js";import{B as C,c as L}from"./app-logo-icon-x1SOUteC.js";import{C as V,a as B,b as Y,c as X}from"./card-BVFCGe6w.js";import{B as le}from"./badge-Dn-j764J.js";import{S as ne,a as re,b as oe,c as ie,d as _}from"./select-dBgjqMYO.js";import{M as Q}from"./map-pin-UZAR4OIn.js";import{E as Ne,T as we}from"./trash-2-Ci-zbAYa.js";import{L as H}from"./label-CcI4GdFx.js";import{a as ve,S as Se,y as D}from"./app-layout-DNXMjC-S.js";import{R as Ce}from"./route-cr5qr0fc.js";/* empty css            */import"./createLucideIcon-D2mHV7LN.js";import"./index-CyfPyRwh.js";import"./index-DeqUbmGT.js";import"./index-CiSEllKo.js";import"./users-DlmphhSp.js";const Re={width:"100%",height:"450px"},Te={lat:10.6676,lng:122.9456},ke=["places","drawing"];function Me({stops:i,setStops:n,clearTrigger:w,polylines:b,setPolylines:f,savedPolylines:h,routeColor:g}){const{isLoaded:d}=me({googleMapsApiKey:"AIzaSyAicbS4J0S5M2DRMdOsImk3FGYFb8tJCPY",libraries:ke}),{appearance:m}=ce(),[N,x]=o.useState(!1),[u,S]=o.useState(null),[M,j]=o.useState(!1),[c,R]=o.useState(null),E=o.useRef([]);o.useEffect(()=>{const l=window.matchMedia("(prefers-color-scheme: dark)").matches;x(m==="dark"||m==="system"&&l)},[m]),o.useEffect(()=>{!h||h.length===0||f(l=>l.length===h.length&&l.every((T,F)=>{const t=h[F];return T.id===t.id&&T.path.length===t.path.length&&T.path.every((s,r)=>s.lat===t.path[r].lat&&s.lng===t.path[r].lng)})?l:h)},[h]),o.useEffect(()=>{w&&(f([]),n([]))},[w,n]),o.useEffect(()=>{if(!u||!h||h.length===0)return;E.current.forEach(p=>p.setMap(null)),E.current=[];const l=new google.maps.LatLngBounds;h.forEach(p=>{const T=p.path.map(t=>{const s=typeof t.lat=="string"?parseFloat(t.lat):t.lat,r=typeof t.lng=="string"?parseFloat(t.lng):t.lng;return l.extend({lat:s,lng:r}),{lat:s,lng:r}}),F=new google.maps.Polyline({path:T,strokeColor:p.color,strokeWeight:3,editable:!1,map:u});E.current.push(F)}),l.isEmpty()||u.fitBounds(l)},[u,h]);const I=l=>{if(!l.latLng)return;const p={lat:l.latLng.lat(),lng:l.latLng.lng()};R({position:p,name:""}),j(!0)},J=()=>{c&&c.name.trim()&&(n([...i,{name:c.name,position:c.position}]),j(!1),R(null))},U=l=>{S(l);const p=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.POLYLINE,drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT,drawingModes:[google.maps.drawing.OverlayType.POLYLINE,google.maps.drawing.OverlayType.MARKER]},polylineOptions:{strokeColor:"#3b82f6",strokeWeight:3,editable:!0,geodesic:!0}});p.setMap(l),google.maps.event.addListener(p,"overlaycomplete",async T=>{if(T.type===google.maps.drawing.OverlayType.POLYLINE){const F=T.overlay,t=F.getPath().getArray().map(r=>({lat:r.lat(),lng:r.lng()})),s={id:Date.now(),path:t,color:g};f(r=>[...r,s]),F.setMap(null)}})};return e.jsxs("div",{className:"flex justify-center py-6",children:[e.jsxs("div",{className:"w-full max-w-6xl rounded-2xl shadow-xl overflow-hidden border border-gray-200 dark:border-gray-700",children:[!d&&e.jsxs("div",{className:"relative h-[450px] flex items-center justify-center bg-gray-100 dark:bg-gray-800 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-blue-500"}),e.jsx("span",{className:"absolute mt-16 text-gray-700 dark:text-gray-200",children:"Loading map..."})]}),d&&e.jsxs(ue,{mapContainerStyle:Re,center:Te,zoom:12,onClick:I,onLoad:U,options:{styles:N?pe:he,disableDefaultUI:!0,zoomControl:!0,gestureHandling:"greedy"},children:[i.map((l,p)=>e.jsx(xe,{position:l.position,title:l.name,label:{text:`${p+1}`,color:N?"#000000":"#FFFFFF",fontSize:"12px",fontWeight:"bold"},icon:{path:google.maps.SymbolPath.CIRCLE,scale:12,fillColor:N?"#FFD700":"#2196F3",fillOpacity:1,strokeWeight:2,strokeColor:N?"#fff":"#000"}},p)),b.map((l,p)=>e.jsx(ge,{path:l.path,options:{strokeColor:l.color,strokeOpacity:1,strokeWeight:3,editable:!0,geodesic:!0}},p))]})]}),e.jsx(ee,{open:M,onOpenChange:l=>{j(l),l||R(null)},children:e.jsxs(te,{children:[e.jsx(se,{children:e.jsx(ae,{children:"Add Stop"})}),e.jsx(P,{placeholder:"Enter stop name",value:c?.name||"",onChange:l=>R(p=>p?{...p,name:l.target.value}:null)}),e.jsxs(je,{children:[e.jsx(C,{variant:"outline",onClick:()=>{j(!1),R(null)},children:"Cancel"}),e.jsx(C,{onClick:J,disabled:!c?.name.trim(),children:"Save"})]})]})})]})}function Fe({className:i,...n}){return e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{className:L("w-full caption-bottom text-sm",i),...n})})}function De({className:i,...n}){return e.jsx("thead",{className:L("[&_tr]:border-b",i),...n})}function Ee({className:i,...n}){return e.jsx("tbody",{className:L("[&_tr:last-child]:border-0",i),...n})}function q({className:i,...n}){return e.jsx("tr",{className:L("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",i),...n})}function W({className:i,...n}){return e.jsx("th",{className:L("h-10 px-2 text-left align-middle font-medium text-muted-foreground",i),...n})}function K({className:i,...n}){return e.jsx("td",{className:L("p-2 align-middle",i),...n})}function Oe({routes:i,onView:n,onDelete:w,onToggleDisable:b}){const f=i.reduce((d,m)=>{const N=`${m.firstTerminal}→${m.secondTerminal}`;return d[N]||(d[N]=[]),d[N].push(m),d},{}),[h,g]=o.useState(()=>Object.fromEntries(Object.entries(f).map(([d,m])=>[d,m?.[0]?.type??"main"])));return i.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Q,{className:"mx-auto h-12 w-12 text-muted-foreground"}),e.jsx("h3",{className:"mt-2 text-sm font-semibold text-foreground",children:"No Routes"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Get started by creating your first route."})]}):e.jsx("div",{className:"space-y-4",children:Object.entries(f).map(([d,m])=>{if(m.length===0)return null;const N=h[d]??m[0].type,x=m.find(u=>u.type===N)||m[0];return e.jsxs(V,{className:"shadow-md max-w-5xl mx-auto",style:{borderLeftColor:x.color},children:[e.jsxs(B,{className:"pb-4 flex flex-col md:flex-row items-start md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs(Y,{className:"flex items-center gap-2 text-lg",children:[e.jsx("span",{className:"truncate",children:x.firstTerminal}),e.jsx("span",{className:"text-muted-foreground",children:"→"}),e.jsx("span",{className:"truncate",children:x.secondTerminal})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs(le,{variant:"secondary",className:"text-xs",children:[x.stops.length," stops"]}),e.jsx("div",{className:"w-4 h-4 rounded-full border border-border",style:{backgroundColor:x.color},"aria-label":`Route color: ${x.color}`})]})]}),e.jsxs("div",{className:"flex flex-shrink-0 gap-2",children:[e.jsxs(ne,{value:N,onValueChange:u=>g(S=>({...S,[d]:u})),children:[e.jsx(re,{children:e.jsx(oe,{placeholder:"Select Variant"})}),e.jsx(ie,{children:m.map(u=>e.jsx(_,{value:u.type,children:u.type},u.id))})]}),n&&e.jsxs(C,{size:"sm",variant:"outline",onClick:()=>n(x),children:[e.jsx(Ne,{className:"w-4 h-4 mr-1"})," View"]}),b&&e.jsx(C,{size:"sm",variant:x.disabled?"outline":"secondary",onClick:()=>b(x.id),children:x.disabled?"Enable":"Disable"}),e.jsxs(C,{size:"sm",variant:"destructive",onClick:()=>w(x.id),children:[e.jsx(we,{className:"w-4 h-4 mr-1"})," Delete"]})]})]}),e.jsx(X,{className:"pt-0",children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(Fe,{children:[e.jsx(De,{children:e.jsxs(q,{className:"bg-muted/30",children:[e.jsx(W,{children:"#"}),e.jsx(W,{children:"Stop Name"}),e.jsx(W,{children:"Coordinates"})]})}),e.jsx(Ee,{children:x.stops.map((u,S)=>e.jsxs(q,{className:"hover:bg-muted/20",children:[e.jsx(K,{className:"font-medium text-muted-foreground",children:S+1}),e.jsx(K,{className:"font-medium",children:u.name||"Unnamed Stop"}),e.jsx(K,{className:"font-mono text-sm",children:u.lat!=null&&u.lng!=null?`${Number(u.lat).toFixed(5)}, ${Number(u.lng).toFixed(5)}`:"No coordinates"})]},S))})]})})})]},d)})})}function Le(){const i=[{name:"Fortune Towne - Central Market",image:"/fortunetowne.jpg"},{name:"Homesite - Central Market",image:"/homesite.jpg"},{name:"Granada - Burgos",image:"/burgosgranada.jpg"}],[n,w]=o.useState(0),[b,f]=o.useState(!1),[h,g]=o.useState({x:0,y:0}),[d,m]=o.useState(null),N=()=>{w(c=>c===0?i.length-1:c-1),f(!1),g({x:0,y:0})},x=()=>{w(c=>c===i.length-1?0:c+1),f(!1),g({x:0,y:0})},u=c=>{b&&(c.preventDefault(),m({x:c.clientX-h.x,y:c.clientY-h.y}))},S=c=>{!b||!d||g({x:c.clientX-d.x,y:c.clientY-d.y})},M=()=>m(null),j=()=>m(null);return e.jsxs(ee,{children:[e.jsx(ye,{asChild:!0,children:e.jsx(C,{children:"Open Map Guide"})}),e.jsxs(te,{className:"max-w-5xl",children:[e.jsxs(se,{children:[e.jsx(ae,{className:"text-xl font-semibold text-center",children:"Map Route Guide"}),e.jsx(be,{className:"text-center",children:"View and navigate through jeepney routes with zoom and pan functionality."})]}),e.jsxs("div",{className:"relative mt-4 flex flex-col items-center overflow-hidden w-full max-h-[600px] rounded-lg",onMouseMove:S,onMouseUp:M,onMouseLeave:j,children:[e.jsx("img",{src:i[n].image,alt:i[n].name,className:`object-cover cursor-${b?"grab":"zoom-in"} transition-transform duration-300`,style:{width:"100%",maxHeight:"600px",transform:`scale(${b?2:1}) translate(${h.x/(b?2:1)}px, ${h.y/(b?2:1)}px)`,cursor:b?"grab":"zoom-in"},onClick:()=>f(c=>!c),onMouseDown:u}),e.jsx("p",{className:"mt-4 text-center text-lg font-medium",children:i[n].name}),e.jsxs("div",{className:"absolute top-1/2 w-full flex justify-between px-6 -translate-y-1/2",children:[e.jsx(C,{variant:"outline",size:"lg",onClick:N,children:"◀"}),e.jsx(C,{variant:"outline",size:"lg",onClick:x,children:"▶"})]})]})]})]})}const ze=[{title:"Map Route",href:"/maproute"}];function tt(){const[i,n]=o.useState([]),[w,b]=o.useState(""),[f,h]=o.useState(""),[g,d]=o.useState([]),[m,N]=o.useState(!0),[x,u]=o.useState(!1),[S,M]=o.useState([]),[j,c]=o.useState(null),[R,E]=o.useState("#3388ff"),[I,J]=o.useState("main");o.useEffect(()=>{$.get("https://turnup-admin.com/sanctum/csrf-cookie",{withCredentials:!0}).then(()=>console.log("CSRF cookie set")).catch(t=>console.error(t))},[]),o.useEffect(()=>{(async()=>{try{const r=await(await fetch("/routes")).json(),z=await Promise.all(r.map(async(a,v)=>{let k=[];if(typeof a.polyline=="string")try{k=JSON.parse(a.polyline).map(A=>({lat:Number(A.lat),lng:Number(A.lng)}))}catch{k=[]}else Array.isArray(a.polyline)?k=a.polyline.map(y=>({lat:Number(y.lat),lng:Number(y.lng)})):a.polyline&&(k=[{lat:Number(a.polyline.lat),lng:Number(a.polyline.lng)}]);const O=await p(k.map(y=>({lat:Number(y.lat),lng:Number(y.lng)})));return{id:a.id??v,firstTerminal:a.first_terminal,secondTerminal:a.second_terminal,polyline:O,stops:a.stops.map(y=>({name:y.name,lat:Number(y.lat),lng:Number(y.lng)})),color:a.color??"#3388ff",type:a.type??"main"}}));n(z)}catch(s){console.error("Failed to fetch routes",s)}})()},[]);const U=async()=>{if(!w||!f){D.error("Please fill in both terminals");return}if(g.length<2){D.error("Please add at least 2 stops before saving the route");return}try{await $.get("https://turnup-admin.com/sanctum/csrf-cookie",{withCredentials:!0});const t={first_terminal:w,second_terminal:f,polyline:S[0]?.path??[],stops:g.map(a=>({name:a.name,lat:a.position.lat,lng:a.position.lng})),color:R,type:I},s=await $.post("https://turnup-admin.com/routes",t,{withCredentials:!0});let r=[];if(typeof s.data.polyline=="string")try{r=JSON.parse(s.data.polyline).map(v=>({lat:Number(v.lat),lng:Number(v.lng)}))}catch{r=[]}else Array.isArray(s.data.polyline)?r=s.data.polyline.map(a=>({lat:Number(a.lat),lng:Number(a.lng)})):s.data.polyline&&(r=[{lat:Number(s.data.polyline.lat),lng:Number(s.data.polyline.lng)}]);const z={id:s.data.id??Date.now(),firstTerminal:s.data.first_terminal,secondTerminal:s.data.second_terminal,polyline:r.map(a=>({lat:Number(a.lat),lng:Number(a.lng)})),stops:s.data.stops.map(a=>({name:a.name,lat:Number(a.lat),lng:Number(a.lng)})),color:"#3388ff",type:s.data.type??"main"};n(a=>[...a,z]),b(""),h(""),d([]),D.success("Route added successfully")}catch(t){D.error("Failed to save route."),console.log(t)}},l=async t=>{try{await $.delete(`https://turnup-admin.com/routes/${t}`,{withCredentials:!0}),n(s=>s.filter(r=>r.id!==t)),j?.id===t&&(c(null),d([]),M([])),D.success("Delete Route Successfully")}catch(s){console.error("Failed to delete route",s),D.error("Failed to delete route.")}},p=async t=>{if(t.length===0)return[];const s=t.filter(v=>!isNaN(v.lat)&&!isNaN(v.lng));if(s.length===0)return[];const z=((v,k)=>{const O=[];for(let y=0;y<v.length;y+=k)O.push(v.slice(y,y+k));return O})(s,100);let a=[];for(const v of z){const O=`https://roads.googleapis.com/v1/snapToRoads?path=${v.map(G=>`${G.lat},${G.lng}`).join("|")}&interpolate=true&key=AIzaSyAicbS4J0S5M2DRMdOsImk3FGYFb8tJCPY`,A=await(await fetch(O)).json();if(A.snappedPoints){const G=A.snappedPoints.map(Z=>({lat:Z.location.latitude,lng:Z.location.longitude}));a=[...a,...G]}}return a},T=async t=>{try{await $.patch(`https://turnup-admin.com/routes/${t}/toggle-disable`,{},{withCredentials:!0}),n(s=>s.map(r=>r.id===t?{...r,disabled:!r.disabled}:r)),D.success("Route status updated")}catch(s){console.error(s),D.error("Failed to update route status")}},F=w&&f&&g.length>=2;return e.jsxs(ve,{breadcrumbs:ze,children:[e.jsx(de,{title:"Map Route"}),e.jsxs(V,{className:"w-full max-w-4xl mx-auto m-6",children:[e.jsx(B,{children:e.jsxs(Y,{className:"flex items-center justify-between",children:["Create Route",e.jsxs(le,{variant:F?"default":"secondary",children:[g.length," stops"]})]})}),e.jsxs(X,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"first_terminal",children:"First Terminal"}),e.jsx(P,{id:"first_terminal",name:"firstTerminal",placeholder:"First Terminal",value:w,onChange:t=>b(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"second_terminal",children:"Second Terminal"}),e.jsx(P,{id:"second_terminal",name:"secondTerminal",placeholder:"Second Terminal",value:f,onChange:t=>h(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"route_color",children:"Route Color"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{type:"color",id:"route_color",value:R,onChange:t=>E(t.target.value),className:"w-12 h-10 p-1 cursor-pointer"}),e.jsx(P,{type:"text",value:R,onChange:t=>E(t.target.value),placeholder:"#3b82f6",className:"flex-1"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"Route Type"}),e.jsxs(ne,{value:I,onValueChange:t=>J(t),children:[e.jsx(re,{children:e.jsx(oe,{placeholder:"Select route type"})}),e.jsxs(ie,{children:[e.jsx(_,{value:"main",children:"Main Route"}),e.jsx(_,{value:"festival",children:"Festival Route"}),e.jsx(_,{value:"detour",children:"Detour Route"}),e.jsx(_,{value:"emergency",children:"Emergency Route"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-lg bg-muted/30",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${g.length<2?"bg-orange-400":"bg-green-400"}`}),e.jsx("p",{className:"text-sm text-muted-foreground",children:g.length<2?"Add at least 2 stops to save and draw routes.":"Ready to save the route"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:[e.jsx(C,{onClick:U,disabled:!w||!f||g.length<2,children:"Save Route"}),e.jsx(C,{variant:"destructive",onClick:()=>u(t=>!t),disabled:g.length===0,children:"Clear Route"}),e.jsx(Le,{})]})]})]}),j&&e.jsx(V,{className:"w-full max-w-4xl mx-auto mt-4",children:e.jsx(B,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"text-blue-500",size:18}),"Route: ",j.firstTerminal," → ",j.secondTerminal]})})}),e.jsx("div",{className:"mt-6",children:e.jsx(Me,{stops:g,setStops:d,clearTrigger:x,polylines:S,setPolylines:M,savedPolylines:j?[{id:j.id,path:j.polyline,color:j.color??"#3388ff"}]:[],snapToRoad:p,routeColor:R})}),e.jsx("div",{className:"m-4",children:e.jsx(C,{onClick:()=>N(!m),children:m?"Hide Routes Table":"Show Routes Table"})}),m&&e.jsx(Oe,{routes:i,onView:t=>{j?.id===t.id?(c(null),d([]),M([])):(d(t.stops.map(s=>({name:s.name,position:{lat:s.lat,lng:s.lng}}))),M([{id:t.id,path:t.polyline,color:t.color}]),c(t))},onDelete:l,onToggleDisable:T}),e.jsxs(V,{className:"m-10",children:[e.jsx(B,{className:"pb-3",children:e.jsxs(Y,{className:"flex items-center gap-2 text-lg",children:[e.jsx(fe,{size:18}),"Quick Start Guide"]})}),e.jsxs(X,{className:"pt-0",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Q,{size:16,className:"text-blue-500"}),e.jsx("h3",{className:"font-medium text-base",children:"Creating a Route"})]}),e.jsxs("ol",{className:"text-sm space-y-2 list-decimal list-inside text-muted-foreground ml-6",children:[e.jsx("li",{children:"Enter start and end terminal names in the form"}),e.jsx("li",{children:"Choose a color for your route visualization"}),e.jsx("li",{children:"Click on the map to add stops along your route"}),e.jsx("li",{children:"Drag stops to adjust their positions if needed"}),e.jsx("li",{children:'Click "Save Route" when you have at least 2 stops'})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Se,{size:16,className:"text-green-500"}),e.jsx("h3",{className:"font-medium text-base",children:"Managing Routes"})]}),e.jsxs("ul",{className:"text-sm space-y-2 list-disc list-inside text-muted-foreground ml-6",children:[e.jsx("li",{children:'Use "Show Routes" to view all your saved routes'}),e.jsx("li",{children:'Click "View" to display a specific route on the map'}),e.jsx("li",{children:'Use "Delete" to remove routes you no longer need'}),e.jsx("li",{children:"Routes are displayed with your chosen color on the map"})]})]})]}),e.jsxs("div",{className:"mt-6 pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ce,{size:16,className:"text-purple-500"}),e.jsx("h3",{className:"font-medium text-base",children:"Tips & Best Practices"})]}),e.jsxs("ul",{className:"text-sm space-y-1 list-disc list-inside text-muted-foreground ml-6 grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsx("li",{children:"Add descriptive terminal names for easy identification"}),e.jsx("li",{children:"Use different colors for each route to distinguish them"}),e.jsx("li",{children:"Place stops in logical order along your intended path"}),e.jsx("li",{children:"Test your route by viewing it before finalizing"})]})]})]})]})]})}export{tt as default};
